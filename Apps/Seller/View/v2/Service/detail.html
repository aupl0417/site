<extend name="Seller@Public:base" />
<block name="body">
    <div class="centent_body">
        <!-- to do your html codeing -->
        <div class="revision_bg">
            <div class="container ptb_size_lg clearfix">
                <!-- 左侧导航 -->
                <include file="Public:sideNav" />
                <!-- 左侧导航结束 -->

                <div class="revisionRight pd15" style="width: 1020px"><!-- 右侧内容 -->
                    <div class="clearfix revisionOrderTab" data-url="">
                        <a class="orderOption active" href="javascript:;">售后详情</a>
                    </div>

                    <div class="content mt30">
                        <table class="no-border mb20 bg_f1"><!-- 类型说明 -->
                            <tbody class="no-border-y">
                            <tr class="text-center">
                                <td width="75%" style="padding:0">
                                    <table class="no-border">
                                        <tbody class="no-border-y">
                                        <td width="10%"></td>
                                        <td width="33%">商品信息</td>
                                        <td width="12%">买家</td>
                                        <td width="10%">申请数量</td>
                                        <td width="12%">售后类型</td>
                                        <td width="18%">状态</td>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            </tbody>
                        </table><!-- 类型说明结束 -->


                        <table class="revisionTable table"><!-- 订单信息 -->
                            <tbody class="bg_white">
                            <tr class="text-center">
                                <td style="padding:0; width:75%">
                                    <table class="no-border table-hover">
                                        <tbody class="no-border-y">
                                        <tr><!-- 同店铺第一个商品 -->
                                            <td width="10%">
                                                <a href="javascript:;" data-url="{:DM('item')}{:U('/index/index', ['id' => $data['orders_goods']['attr_list_id']])}">
                                                    <img src="{:myurl($data['orders_goods']['images_'], 80)}" class="img-thumbnail"></a>
                                            </td>
                                            <td valign="top" width="33%" class="text-left">
                                                <a href="javascript:;" data-url="{:DM('item')}{:U('/index/index', ['id' => $data['orders_goods']['attr_list_id']])}">{$data.orders_goods.goods_name}</a>
                                                <div class="md5 text-gray mt5">颜色/尺码：{$data.orders_goods.attr_name}</div>
                                            </td>
                                            <td width="12%">
                                                <span class="text_yellow">{$data.user.nick}</span>
                                            </td>
                                            <td width="10%">×{$data.num}</td>
                                            <td width="12%">
                                                {$data.type_name}
                                            </td>
                                            <td width="18%">
                                                {$data.status_name}
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            </tbody>
                        </table><!-- 订单信息结束 -->
                    </div>

                    <div class="row" style="border-bottom: solid 1px #F0F0F0;border-top: solid 1px #F0F0F0; padding: 30px 0">
                        <div class="col-md-4 col-sm-6 text-center">
                            <h4>&nbsp;</h4>
                            <switch name="data.status">
                                <case value="1">
                                    <a href="{:U('/service/agree', ['id' => $data['r_no']])}" title="同意售后" class="btn btn-sm btn-primary btn-rad btn-trans">同意售后</a>
                                    <div class="mt5">
                                        <a href="{:U('/service/reject', ['id' => $data['r_no']])}" title="拒绝售后" class="text_blue">拒绝售后</a>
                                    </div>
                                    <div class="mt5 text-gray countdown-box" data-remark="自动取消" data-time="{:str_replace('-', '/', $data['next_time'])}"></div>
                                </case>
                                <case value="2">
                                    <div class="btn btn-sm btn-primary btn-rad btn-trans">等待买家操作</div>	<!-- 拒绝售后 -->
                                    <div class="mt5 text-gray countdown-box" data-remark="自动取消" data-time="{:str_replace('-', '/', $data['next_time'])}"></div>
                                </case>
                                <case value="3">
                                    <div class="btn btn-sm btn-primary btn-rad btn-trans">等待买家操作</div>
                                    <div class="mt5 text-gray countdown-box" data-remark="自动取消" data-time="{:str_replace('-', '/', $data['next_time'])}"></div>
                                </case>
                                <case value="4">
                                    <a href="{:U('/service/accept', ['id' => $data['r_no']])}" title="已收到货" class="btn btn-sm btn-primary btn-rad btn-trans">已收到货</a>
                                    <div class="mt5">
                                        <a href="{:U('/service/appeal', ['id' => $data['r_no']])}" title="未收到货" class="text_blue">未收到货</a>
                                    </div>
                                    <div class="mt5 text-gray countdown-box" data-remark="自动收货" data-time="{:str_replace('-', '/', $data['next_time'])}"></div>
                                </case>
                                <case value="5">
                                    <a href="{:U('/service/express', ['id' => $data['r_no']])}" title="寄出商品" class="btn btn-sm btn-primary btn-rad btn-trans">寄出商品</a>
                                </case>
                                <case value="6">
                                    <div class="btn btn-sm btn-primary btn-rad btn-trans">卖家寄出商品</div>
                                    <div class="mt5 text-gray countdown-box" data-remark="自动收货" data-time="{:str_replace('-', '/', $data['next_time'])}"></div>
                                </case>
                                <case value="10">
                                    <div class="btn btn-sm btn-primary btn-rad btn-trans">等待仲裁</div>
                                </case>
                                <case value="20">
                                    <div class="btn btn-sm btn-primary btn-rad btn-trans">售后已取消</div>
                                </case>
                                <case value="100">
                                    <div class="btn btn-sm btn-primary btn-rad btn-trans">售后已完成</div>
                                </case>
                            </switch>
                        </div>
                        <div class="col-md-4 col-sm-6" style="border-right: solid 1px #F0F0F0; border-left: solid 1px #F0F0F0">
                            <h4>物流信息</h4>
                            <div class="text-center">
                                <empty name="express">
                                    {:W('Common/Builder/nors', array('param' => array('text' => $data['msg'])))}
                                    <else />
                                    <volist name="express" id="vo">
                                        <eq name="i" value="1">
                                            <a data-type="modal" data-url="{:U('/tool/express', ['company' => $vo['express_company_id'], 'code' => $vo['express_code']])}" data-title="买家邮寄商品物流信息" class="btn btn-sm btn-primary btn-rad btn-trans opreating">买家邮寄商品物流信息</a>
                                            <else />
                                            <div class="mt5">
                                                <a data-type="modal" data-url="{:U('/tool/express', ['company' => $vo['express_company_id'], 'code' => $vo['express_code']])}" data-title="卖家邮寄商品物流信息" class="btn btn-sm btn-primary btn-rad btn-trans opreating">卖家邮寄商品物流信息</a>
                                            </div>
                                        </eq>
                                    </volist>
                                </empty>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6">
                            <h4>申请售后照片</h4>
                            <notempty name="data.images">
                                <php>
                                    $images	=	explode(',',rtrim($data['images'], ','));
                                </php>
                                <ul class="images-select-box">
                                    <volist name="images" id="vo">
                                        <li style="width: 100px;height: 100px;padding: 0;" id="" data-path="{$vo}" class="text-center">
                                            <div style="width: 100px; height: 100px" class="li-img-box">
                                                <a href="{$vo}" class="image-zoom" title="大图">
                                                    <img style="width: 80px" src="{:myurl($vo, 80)}">
                                                </a>
                                            </div>
                                        </li>
                                    </volist>
                                </ul>
                                <else />
                                {:W('Common/Builder/nors', array('param' => array('text' => $data['msg'])))}
                            </notempty>
                        </div>
                    </div>

                    <div class="row" style="padding: 30px 0">
                        <div class="col-md-4 col-sm-6">
                            <h4>订单信息</h4>
                            <p>
                                售后编号：{$data.r_no}
                            </p>
                            <p>
                                申请时间：{$data.atime}
                            </p>
                            <p>
                                买家信息：{$data.user.nick}
                            </p>
                            <p class="word-break">
                                申请理由：{$data.reason}
                            </p>
                        </div>
                        <div class="col-md-8 col-sm-6" style="border-left: solid 1px #F0F0F0;">
                            <h4>售后日志</h4>
                            <notempty name="data.logs">
                                <div class="pd20" id="express" style="max-height: 500px;overflow: auto;">
                                    <div class="ml40 pl20">
                                        <div class="block-transparent">
                                            <ul class="timeline">
                                                <volist name="data.logs" id="vo">
                                                    <li>
                                                        <i class="fa fa-angle-double-down green"></i>
                                                        <span class="date">{$vo.atime}</span>
                                                        <div class="content text-break-all">
                                                            <p><strong><notempty name="vo.user.nick">{$vo.user.nick}<else />雇员操作</notempty></strong></p>
                                                            <p>{$vo.remark}</p>
                                                            <notempty name="vo.images">
                                                                <div class="mt10">
                                                                    <volist name="vo.images" id="images">
                                                                        <a href="{$images}" class="image-zoom mr10" title="大图">
                                                                            <img src="{:myurl($images, 80)}">
                                                                        </a>
                                                                    </volist>
                                                                </div>
                                                            </notempty>
                                                            <if condition="$vo['express_code'] neq '' or $vo['address'] neq '' or $vo['num'] gt 0 or $vo['money'] gt 0 or $vo['refund_express'] gt 0">
                                                                <div class="logs-sys-box">
                                                                    <notempty name="vo.express_code"><div>物流公司：{$vo.express_company}，运单号：{$vo.express_code}</div></notempty>
                                                                    <notempty name="vo.address"><div>收货地址：{$vo.address}</div></notempty>
                                                                    <div>
                                                                        <gt name="vo.num" value="0">申请{$vo.num}件商品售后；</gt>
                                                                    </div>
                                                                </div>
                                                            </if>
                                                        </div>
                                                    </li>
                                                </volist>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <else />
                                {:W('Common/Builder/nors', array('param' => array('text' => $data['msg'])))}
                            </notempty>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!-- my codeing over -_-   -->

    </div>
</block>

<block name="css">

</block>

<block name="script">
    <!-- to do your javascript codeing -->
    <script>
        $(document).ready(function() {
            $(".opreating").click(function() {
                var d 	=	$(this).data();
                vmodal({
                    title:d.title,
                    url:d.url,
                });
            });

            if ($('.countdown-box').size() > 0) {
                var data = $('.countdown-box').data();
                var timer	=	setInterval(function countDown(){
                    var EndTime= new Date(data.time);
                    var NowTime = new Date();
                    var t =EndTime.getTime() - NowTime.getTime();
                    var d=0;
                    var h=0;
                    var m=0;
                    var s=0;
                    if(t>=0){
                        d=Math.floor(t/1000/60/60/24);
                        h=Math.floor(t/1000/60/60%24);
                        m=Math.floor(t/1000/60%60);
                        s=Math.floor(t/1000%60);
                    } else {
                        setInterval(timer);
                    }
                    var html = d+"天"+h+"小时"+m+"分"+s+"秒后" + data.remark;
                    $('.countdown-box').html(html);
                },0);
            }
        })
    </script>
</block>