<extend name="Home@Public:base" />
<block name="body">
<link rel="stylesheet" type="text/css" href="/Public/new_design/flatdream/js/jquery.icheck/skins/all.css">
<div class="centent_body">
	<include file="Public:nav" />
	<div class="container mb30">
		<include file="Public:side" />
		<div class="w980 bor_der mb20 fl">
				<form method="get">
					<input type="hidden" name="p" value="1"/>
					<div class="">
						<div class="bg_f1 clearfix fs14 text_44 tle_R orders-tab" data-url="__SELF__">
							<a class="fl plr15 line40 ml-1" href="{:U('/orders')}">所有订单</a>
							<notempty name="ordersType">
								<volist name="ordersType" id="vo">
									<a class="fl plr15 line40 ml-1" href="{:U('/orders/index', ['sid' => $key])}">{$vo}</a>
								</volist>
							</notempty>
							<div class="fl ml40 mt5 mb0" style="width:300px">
								<div class="input-group input-group-sm mb0">
									<input type="text" class="form-control" name="s_no" placeholder="输入订单号搜索">
									<span class="input-group-btn">
										<button class="btn btn-primary" type="submit">搜索</button>
									</span>
									<span class="input-group-btn">
										<button id="hige_search" class="btn btn-default plr20" type="button">
											高级搜索<i class="fa fa-angle-down ml5"></i>
										</button>
									</span>
								</div>
							</div>
						</div><div class="solid_t mt-1"></div>	
					</div>
				</form>
				<empty name="data.list">
				<form method="get" class="form-inline">
					<input type="hidden" name="p" value="1"/>
					<div class="pd15 form-body">
						<div id="search_dn" class="plr15 pb10 clearfix dn">
							<div class="form-group">
								<input class="form-control fs14 fl mr10" style="width:120px" type="text" name="goods_name" placeholder="商品名称" value='{$_GET.goods_name}'>
								<input class="form-control fs14 fl" style="width:120px" type="text" name="nick" placeholder="买家会员名称">
								<div class="fl fs14 ml20 mr5 mt6">订单日期</div>	
								<div class="input-group date datetime fl" data-min-view="2" data-date-format="yyyy-mm-dd" style="width:120px">
										<input name="sday" data-filter="gte" class="form-control form-filter" readonly="sday" id="sday" type="text" placeholder="开始时间">
										<span class="input-group-addon btn default"><span class="glyphicon glyphicon-th fa fa-calendar"></span>
									</span>
								</div>
								<!-- <input class="form-control fl" style="width:120px" type="text" name="sday" placeholder="开始时间"> -->
								<span class="fl plr5 mt7">-</span>
								<!-- <input class="form-control fl" style="width:120px" type="text" name="eday" placeholder="结束时间"> -->
								<div class="input-group fl date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="width:120px">
										<input name="eday" data-filter="lte" class="form-control form-filter" readonly="eday" id="eday" type="text" placeholder="结束时间">
										<span class="input-group-addon btn default"><span class="glyphicon glyphicon-th fa fa-calendar"></span>
									</span>
								</div>
							</div>
							<button class="btn btn-primary" type="submit">搜索</button>
							
						</div>
						<div class="row mg0 test_black fs14 strong hide">
							<div class="col-xs-2">
								<label class="square mr10 mt2 fl fs12"><input type="checkbox" name="all_choice"><span></span></label>全选
								<span class = "fs12" style = "padding:3px;background:#c81623;color:#fff;" onclick = "out_excel()">导出</span>
								
							</div>
							<div class="col-xs-3 text-center">商品信息</div>
							<div class="col-xs-1 text-center">单价</div>
							<div class="col-xs-1 text-center">数量</div>
							<div class="col-xs-1 text-center">运费</div>
							<div class="col-xs-1 text-center">实付款</div>
							<div class="col-xs-2 pd0 text-center">状态</div>
							<div class="col-xs-1 text-center">操作</div>
						</div>
					</div>
				</form>
				<form action = "" class = "out_excel" target="_blank" method="post">
					<input type = "hidden" name = "order_ids" value = ""/>
					<input type = "hidden" name = "is_out_excel" value = "1"/>
					<input type = "submit" class = "dn"/>
				</form>
					{:W('Common/Builder/nors', array('param' => array('text' => '无任何订单，赶紧去推广吧。')))}
				<else />
				<form method="get" class="form-inline">
					<input type="hidden" name="p" value="1"/>
					<div class="pd15 form-body">
						<div id="search_dn" class="plr15 pb10 clearfix dn">
							<div class="form-group">
								<input class="form-control fs14 fl mr10" style="width:120px" type="text" name="goods_name" placeholder="商品名称" value='{$_GET.goods_name}'>
								<input class="form-control fs14 fl" style="width:120px" type="text" name="nick" placeholder="买家会员名称">
								<div class="fl fs14 ml20 mr5 mt6">订单日期</div>	
								<div class="input-group date datetime fl" data-min-view="2" data-date-format="yyyy-mm-dd" style="width:120px">
										<input name="sday" data-filter="gte" class="form-control form-filter" readonly="sday" id="sday" type="text" placeholder="开始时间">
										<span class="input-group-addon btn default"><span class="glyphicon glyphicon-th fa fa-calendar"></span>
									</span>
								</div>
								<!-- <input class="form-control fl" style="width:120px" type="text" name="sday" placeholder="开始时间"> -->
								<span class="fl plr5 mt7">-</span>
								<!-- <input class="form-control fl" style="width:120px" type="text" name="eday" placeholder="结束时间"> -->
								<div class="input-group fl date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="width:120px">
										<input name="eday" data-filter="lte" class="form-control form-filter" readonly="eday" id="eday" type="text" placeholder="结束时间">
										<span class="input-group-addon btn default"><span class="glyphicon glyphicon-th fa fa-calendar"></span>
									</span>
								</div>
							</div>
							<button class="btn btn-primary" type="submit">搜索</button>
							
						</div>
						<div class="row mg0 test_black fs14 strong">
							<div class="col-xs-2">
								<label class="square mr10 mt2 fl fs12"><input type="checkbox" name="all_choice"><span></span></label>全选
								<span class = "fs12" style = "padding:3px;background:#c81623;color:#fff;" onclick = "out_excel()">导出</span>
								
							</div>
							<div class="col-xs-3 text-center">商品信息</div>
							<div class="col-xs-1 text-center">单价</div>
							<div class="col-xs-1 text-center">数量</div>
							<div class="col-xs-1 text-center">运费</div>
							<div class="col-xs-1 text-center">实付款</div>
							<div class="col-xs-2 pd0 text-center">状态</div>
							<div class="col-xs-1 text-center">操作</div>
						</div>
					</div>
				</form>
				<form action = "" class = "out_excel" target="_blank" method="post">
					<input type = "hidden" name = "order_ids" value = ""/>
					<input type = "hidden" name = "is_out_excel" value = "1"/>
					<input type = "submit" class = "dn"/>
				</form>

				<div class="solid_t pd15">
					<volist name="data.list" id="vo">
						<php>
							$count = count($vo['orders_goods']);
						</php>
						<table class="table table-bordered table-advance table-hover mb30">
							<tbody>
								<tr>
									<th class="col-xs-2 text_yellow">
										<label class="square mr10 fl" style="margin-bottom:0px;"><input type="checkbox" name = 'order_id[]' value = "{$vo.id}"><span></span></label>
										{$vo.pay_typename}
									</th>
									<th class="col-xs-3">订单号：<a href="{:U('/orders/detail', array('id' => $vo['s_no']))}" target="_blank">{$vo.s_no}</a></th>
									<th class="col-xs-7" colspan="6" class="col-lg-1">{$vo.atime}<a class="text_44 mr20" href="{:DM('shop')}">{$vo.shop.shop_name}</a>
										<div class="pull-right {$vo['seller_remark_color']?$vo['seller_remark_color']:'text-gray'}" style="cursor:pointer;"><i class="fa fa-flag" title="备注" onclick="vmodal({title:'备注',url:'__URL__/remark_add/s_no/{$vo.s_no}',width:'700px'})"></i></div>
										
										<a class="text_44" target="_blank" href="{:DM('oauth2')}{:U('Im/check',['receiver' => $vo['buyer']['nick']])}"><img class="mr5" width="12" src="/Public/images/icon-im.png">买家：{$vo.buyer.nick}</a>
									</th>
								</tr>
								<notempty name="vo.activity">
									<tr>
										<td style="vertical-align: middle;" class="strong text_yellow">
											参与促销活动
										</td>
										<td colspan="7">
											<notempty name="vo.activity">
												<volist name="vo.activity" id="ac">
													<switch name="ac.type_id">
														<case value="2">
														{$key + 1}、<span class="text_yellow">满 {$ac.full_money} 送 </span>
														<volist name="ac.goods" id="ag">
															<a href="javascript:;" data-url="{:DM('item')}{:U('/index/index', ['id' => $ag['attr_list'][0]['id']])}">
																<img src="{$ag.images}" width="40px" />
															</a>
														</volist>
														</case>
														<default />
														{$key + 1}、<span class="text_yellow mr10">{$ac.remark}</span>
													</switch>
												</volist>
											</notempty>
										</td>
									</tr>
								</notempty>
								<gt name="vo.coupon_id" value="0">
									<tr>
										<td style="vertical-align: middle;" class="strong text_yellow">
											优惠券
										</td>
										<td colspan="7">
										使用了￥ <span class="text_yellow">{$vo.coupon.price}</span> 元优惠券
										</td>
									</tr>
								</gt>
								<volist name="vo.orders_goods" id="goods">
									
									<tr class="countTr">
										<td style="vertical-align: middle;" class="text-center col-xs-2"><a target="_blank" href="{:DM('item')}{:U('/index/index', array('id' => $goods['attr_list_id']))}"><img src="{$goods['images']}" class="img-thumbnail"></a></td>
										<td class="col-xs-3">
											<a href="javascript:;" data-url="{:DM('item')}{:U('/index/index', array('id' => $goods['attr_list_id']))}">{$goods.goods_name}</a>
											<div class="md5 text-gray mt5">颜色/尺码：{$goods.attr_name}</div>
											<notempty name="goods.activity_name"><span class="btn btn-primary btn-trans btn-xs m0">{$goods.activity_name}</span></notempty>
											<gt name="vo.daigou_cost" value="0">
											<span class="btn btn-primary btn-trans btn-xs m0">代购商品</span>
											</gt>
										</td>
										<td style="vertical-align: middle;" class="text-center col-xs-1"><span class="text-d-lt">{$goods.price}</span><br /><span class="text_yellow">({$goods.total_price_edit})</span></td>
										<td style="vertical-align: middle;" class="text-center col-xs-1">×{$goods.num}</td>
										<eq name="key" value="0">
										<td style="vertical-align: middle;" class="text-center col-xs-1" rowspan="{$count}">
											<span class="text-d-lt">{$vo.express_price}</span><br /><span class="text_yellow">({$vo.express_price_edit})</span>
											<in name="vo.status" value="4,5">
												<gt name="vo.serviceover" value="0">
												<br />
												<span class="text_yellow">
												售后已完成
												</span>
												</gt>
												<gt name="vo.serviceing" value="0">
												<br />
												<span class="text_yellow">
												售后中
												</span>
												</gt>
											</in>
											<in name="vo.status" value="2,3">
												<gt name="vo.refundover" value="0">
												<br />
												<span class="text_yellow">
												退款已完成
												</span>
												</gt>
												<gt name="vo.refunding" value="0">
												<br />
												<span class="text_yellow">
												退款中
												</span>
												</gt>
											</in>
										</td>
										<td style="vertical-align: middle;" class="text-center col-xs-1" rowspan="{$count}">
											<span class="text-d-lt">{$vo.total_price}</span><br /><span class="text_yellow">{$vo.pay_price}</span><br /><span>含运费({$vo.express_price_edit})</span><gt name="vo.daigou_cost" value="0"><br /><span>含手续费({$vo.daigou_cost})</span></gt>
										</td>
										<td style="vertical-align: middle;" class="text-center col-xs-2" rowspan="{$count}">
											
											<switch name="vo.status">
												<case value="1">
													<div class="btn btn-primary btn-ml text-center btn_m w100">等待买家付款</div>
													<div data-type="modal" data-url="{:U('/orders/editPrice', ['id' => $vo['s_no']])}" data-title="修改价格" class="btn btn-info btn-ml text-center btn_m mt10 opreating w100">修改价格</div>
													<div data-type="modal" data-url="{:U('/orders/opreat', ['type' => 'close', 'id' => $vo['s_no']])}" data-title="订单关闭" class="btn btn-default btn-ml text-center btn_m mt10 opreating w100">关闭订单</div>
												</case>
												<case value="2">
													<div class="btn btn-primary btn-ml text-center btn_m w100">买家已付款</div>
													<div data-type="modal" data-url="{:U('/orders/opreat', ['type' => 'ship', 'id' => $vo['s_no']])}" data-title="立即发货" class="btn btn-success btn-ml text-center btn_m mt10 opreating w100">立即发货</div>
												</case>
												<case value="3">
													<div class="btn btn-warning btn-ml text-center btn_m w100">等待买家收货</div>
												</case>
												<case value="4">
													<div class="btn btn-info btn-ml text-center btn_m w100">买家已收货</div>
												</case>
												<case value="5">
													<div class="btn btn-success btn-ml text-center btn_m w100">买家已评价</div>
												</case>
												<case value="10">
													<div class="btn btn-primary btn-ml text-center btn_m w100">订单已关闭</div>
												</case>
												<case value="11">
													<div class="btn btn-primary btn-ml text-center btn_m w100">退款完成</div>
												</case>
												<case value="20">
													<div class="btn btn-primary btn-ml text-center btn_m w100">退款订单</div>
												</case>
												<case value="30">
													<div class="btn btn-primary btn-ml text-center btn_m w100">售后订单</div>
												</case>
											</switch>
											<notempty name="vo['refund']">
											<gt name="vo.status" value="3">
												<a class="btn btn-primary  text-center btn_m mt10  w100" href="{:U('/service/index', ['sno' => $vo['s_no']])}">存在售后</a>
											<else />
												<a class="btn btn-primary  text-center btn_m mt10  w100" href="{:U('/refund/index', ['sno' => $vo['s_no']])}">存在退款</a>
											</gt>
											</notempty>
										</td>
										<td style="vertical-align: middle;" class="text-center col-xs-2" rowspan="{$count}"><a class="text_blue" href="{:U('/orders/detail', array('id' => $vo['s_no']))}" target="_blank">订单详情</a></td>
										</eq>
									</tr>
								</volist>
							</tbody>
						</table>
					</volist>
					
					<div class="page-box">
						{:page_html($data['pageinfo'])}
					</div>
				</div>
				</empty>
		</div>
	</div>
</div>
</block>
<block name="css">
<script src="__FLATDREAM__/js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="__FLATDREAM__/js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<link rel="stylesheet" href="__FLATDREAM__/js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.css" />
</block>
<block name="script">
<script>
$(document).ready(function() {
	$(".datetime").datetimepicker({
		format : 'yyyy-mm-dd'
	});
	$('.datetime').datetimepicker({
		language:  'zh-CN',
		weekStart : 1,
		todayBtn : 1,
		autoclose : 1,
		todayHighlight : 1,
		startView : 2,
		forceParse : 0,
		showMeridian : 1
	});
	$(".opreating").click(function() {
		var d 	=	$(this).data();
		if(d.width == undefined) {
			d.width	=	'50%';
		}
		vmodal({
			title:d.title,
			url:d.url,
			width:d.width,
		});
	});
	$('#hige_search').click(function(){
		$('#search_dn').slideToggle('slow')
	});
})

$("input[name='all_choice']").change(function(){
	if($(this).is(':checked')){
		$("input[name='order_id[]']").each(function(){
			$(this).prop('checked', true);
			//$("input[type='checkbox']").prop('checked', true);
		})
	}else{
		$("input[name='order_id[]']").each(function(){
			$(this).prop('checked', false);
		})
	}
});

//导出excel
function out_excel(){
	var order_ids = '';
	$("input[name='order_id[]']").each(function(){
		if($(this).is(':checked')){
			order_ids+=$(this).val()+'|';
		}
	});
	order_ids = order_ids.substr(0,order_ids.length-1);
	$(".out_excel input[name='order_ids']").val(order_ids);
	$(".out_excel .dn").click();
	//alert(this.location.href);
	
}

</script>
</block>