<extend name="Home@Public:base" />
<block name="body">
<div class="centent_body mt10">

    <include file="Public:nav_statistic" />

    <div class="container">

        <include file="Public:side_statistic" />

        <div class="w960 fl">
            <ol class="breadcrumb pd10 bor_der bor_r0 mt0 mb20">
                <li><a href="/">数据统计 </a> </li>
                <li><a href="">促销分析</a></li>
                <li><a href="">促销概况</a></li>
            </ol>

            <div class="mb35">
                <div class="ptb10 solid_b mb20">
                    <span class="fs16">促销总览</span>
                </div>
                <div class="mb10">
                    <strong class="fs14 text_black mr20">选择时间</strong>
                    <a class="text_yellow plr20 <if condition='$con[total_type] eq 1'>btn btn-primary btn-xs </if>" onclick = "select_change('total','type',1)">昨天</a>
                    <a class="text_yellow plr20 <if condition='$con[total_type] eq 2'>btn btn-primary btn-xs </if>" onclick = "select_change('total','type',2)">最近一周</a>
                    <a class="text_yellow plr20 <if condition='$con[total_type] eq 3'>btn btn-primary btn-xs </if>" onclick = "select_change('total','type',3)">最近一个月</a>
                    <a class="text_yellow plr20 <if condition='$con[total_type] eq 4'>btn btn-primary btn-xs </if>" onclick = "select_change('total','type',4)">最近三个月</a>
                    <div class="pull-right btn-group btn-group-sm mt-5">
                        <button type="button" class="btn btn-primary plr20 <if condition='$con[total_terminal] neq 1'> btn-trans</if>" onclick = "select_change('total','terminal',1)">全部</button>
                        <button type="button" class="btn btn-primary plr20 <if condition='$con[total_terminal] neq 2'> btn-trans</if>" onclick = "select_change('total','terminal',2)">pc端</button>
                        <button type="button" class="btn btn-primary plr20 <if condition='$con[total_terminal] neq 3'> btn-trans</if>" onclick = "select_change('total','terminal',3)">手机端</button>
                    </div>
                </div>
                <table class="bg_white">
                    <tbody class="solid_t">
                        <tr>
                            <td class="fs14 pd20">
                                <p class="mb15 fs16">
                                    促销成交笔数 
                                    <small class="fa fa-question-circle ml10 text_yellow" data-placement="top" data-toggle="tooltip" data-original-title="Tooltip on top"></small>
                                </p>
                                <strong class="text_yellow">{$promotion_data.buy_num}</strong>
                                <h6 class="text_77 mt15">
                                    环比增幅 
                                    <span class="pull-right <if condition="$goods_data.buy_num_type eq 1">text_yellow<else/>text_green</if>"><i class="fa <if condition="$goods_data.buy_num_type eq 1">fa-long-arrow-up<else/>fa-long-arrow-down</if> mr5"></i>{$promotion_data.buy_num_percen}%</span>
                                </h6>
                            </td>
                            <td class="fs14 pd20">
                                 <p class="mb15 fs16">
                                    促销成交金额(元) 
                                    <small class="fa fa-question-circle ml10 text_yellow" data-toggle="tooltip" title="" data-original-title="sad"></small>
                                </p>
                                <strong class="text_yellow">{$promotion_data.buy_nmoney}</strong>
                                <h6 class="text_77 mt15">
                                    环比增幅 
                                    <span class="pull-right <if condition="$goods_data.buy_money_type eq 1">text_yellow<else/>text_green</if>"><i class="fa <if condition="$goods_data.buy_money_type eq 1">fa-long-arrow-up<else/>fa-long-arrow-down</if> mr5"></i>{$promotion_data.buy_money_percen}%</span>
                                </h6>
                            </td>
                            <td class="fs14 pd20">
                                 <p class="mb15 fs16">
                                    广告投放笔数 
                                    <small class="fa fa-question-circle ml10 text_yellow" data-toggle="tooltip" title="" data-original-title="sad"></small>
                                </p>
                                <strong class="text_yellow">{$promotion_data.ad_num}</strong>
                                <h6 class="text_77 mt15">
                                    环比增幅 
                                    <span class="pull-right <if condition="$goods_data.ad_num_type eq 1">text_yellow<else/>text_green</if>"><i class="fa <if condition="$goods_data.ad_num_type eq 1">fa-long-arrow-up<else/>fa-long-arrow-down</if> mr5"></i>{$promotion_data.ad_num_percen}%</span>
                                </h6>
                            </td>
                            <td class="fs14 pd20">
                                 <p class="mb15 fs16">
                                    广告投放金额(元) 
                                    <small class="fa fa-question-circle ml10 text_yellow" data-toggle="tooltip" title="" data-original-title="sad"></small>
                                </p>
                                <strong class="text_yellow">{$promotion_data.ad_money}</strong>
                                <h6 class="text_77 mt15">
                                    环比增幅 
                                    <span class="pull-right <if condition="$goods_data.ad_money_type eq 1">text_yellow<else/>text_green</if>"><i class="fa <if condition="$goods_data.ad_money_type eq 1">fa-long-arrow-up<else/>fa-long-arrow-down</if> mr5"></i>{$promotion_data.ad_money_percen}%</span>
                                </h6>
                            </td>
                            <td class="fs14 pd20">
                                <p class="mb15 fs16">
                                    使用优惠券金额(元) 
                                    <small class="fa fa-question-circle ml10 text_yellow" data-toggle="tooltip" title="" data-original-title="sad"></small>
                                </p>
                                <strong class="text_yellow">{$promotion_data.coupon_money}</strong>
                                <h6 class="text_77 mt15">
                                    环比增幅 
                                    <span class="pull-right <if condition="$goods_data.coupon_money_type eq 1">text_yellow<else/>text_green</if>"><i class="fa <if condition="$goods_data.coupon_money_type eq 1">fa-long-arrow-up<else/>fa-long-arrow-down</if> mr5"></i>{$promotion_data.coupon_money_percen}%</span>
                                </h6>
                            </td>
                        </tr>

                    </tbody>
                </table>
            </div>

            <div class="mb35">
                <div class="ptb10 solid_b mb20">
                    <span class="fs16">促销趋势</span>
                </div>
                <div class="mb10">
                    <strong class="fs14 text_black mr20">选择时间</strong>
                    <a class="text_yellow plr20 <if condition='$con[trend_type] eq 1'>btn btn-primary btn-xs </if>" onclick = "select_change('trend','type',1)">昨天</a>
                    <a class="text_yellow plr20 <if condition='$con[trend_type] eq 2'>btn btn-primary btn-xs </if>" onclick = "select_change('trend','type',2)">最近一周</a>
                    <a class="text_yellow plr20 <if condition='$con[trend_type] eq 3'>btn btn-primary btn-xs </if>" onclick = "select_change('trend','type',3)">最近一个月</a>
                    <a class="text_yellow plr20 <if condition='$con[trend_type] eq 4'>btn btn-primary btn-xs </if>" onclick = "select_change('trend','type',4)">最近三个月</a>
                    <div class="pull-right btn-group btn-group-sm mt-5">
                        <button type="button" class="btn btn-primary plr20 <if condition='$con[trend_terminal] neq 1'> btn-trans</if>" onclick = "select_change('trend','terminal',1)">全部</button>
                        <button type="button" class="btn btn-primary plr20 <if condition='$con[trend_terminal] neq 2'> btn-trans</if>" onclick = "select_change('trend','terminal',2)">pc端</button>
                        <button type="button" class="btn btn-primary plr20 <if condition='$con[trend_terminal] neq 3'> btn-trans</if>" onclick = "select_change('trend','terminal',3)">手机端</button>
                    </div>
                </div>
                <div class="mb10">
                    <div class="clearfix ">
                        <span class="pull-left mr15">查看指标</span>

                        <label class="square mr10 fl list-checkbox">
                            <input type="checkbox" <if condition="$con['field_buy_num'] eq 1">checked="checked"</if> onchange="field_change(this,'buy_num')"><span class="pull-left"></span>
                            <span class="fl ml2 small_xs">促销成交笔数</span>
                        </label>
                        <label class="square mr10 fl list-checkbox">
                            <input type="checkbox" <if condition="$con['field_buy_money'] eq 1">checked="checked"</if> onchange="field_change(this,'buy_money')"><span class="pull-left"></span>
                            <span class="fl ml2 small_xs">促销成交金额</span>
                        </label>
                        <label class="square mr10 fl list-checkbox">
                            <input type="checkbox" <if condition="$con['field_ad_money'] eq 1">checked="checked"</if> onchange="field_change(this,'ad_money')"><span class="pull-left"></span>
                            <span class="fl ml2 small_xs">促销投放金额</span>
                        </label>
                        <label class="square mr10 fl list-checkbox">
                            <input type="checkbox" <if condition="$con['field_coupon_money'] eq 1">checked="checked"</if> onchange="field_change(this,'coupon_money')"><span class="pull-left"></span>
                            <span class="fl ml2 small_xs">使用优惠券金额</span>
                        </label>
                    </div>
                    <div id="chartdiv" style="width: 100%; height: 400px;"></div>
                </div>
            </div>


        </div>

    </div>
</div>
<form action="" method="post" class="hide page_select">
	<foreach name="con" item="vo" key="key">
		<input type="hidden" name="{$key}" value="{$vo}"/>
	</foreach>	
</form>
</block>

<block name="css"></block>
<block name="script">

<script src="__NEW_DESIGN__flatdream/js/jquery.js"></script>
<script src="__NEW_DESIGN__flatdream/js/jquery.pushmenu/js/jPushMenu.js"></script>
<script type="text/javascript" src="__NEW_DESIGN__flatdream/js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
<script type="text/javascript" src="__NEW_DESIGN__flatdream/js/jquery.sparkline/jquery.sparkline.min.js"></script>
<script type="text/javascript" src="__NEW_DESIGN__flatdream/js/jquery.ui/jquery-ui.js"></script>
<script type="text/javascript" src="__NEW_DESIGN__flatdream/js/jquery.gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="__NEW_DESIGN__flatdream/js/behaviour/core.js"></script>
<script src="__NEW_DESIGN__flatdream/js/bootstrap/dist/js/bootstrap.min.js"></script>

<script type="text/javascript" src="__NEW_DESIGN__flatdream/js/jquery.flot/jquery.flot.js"></script>

<script src="__NEW_DESIGN__js/amcharts.js" type="text/javascript"></script>
<script src="__NEW_DESIGN__js/serial.js" type="text/javascript"></script>
<script src="__NEW_DESIGN__js/pie.js"></script>
<script>
   var chart;
   var chartData = [];

   AmCharts.ready(function () {
       // generate some random data first
       generateChartData();

       // SERIAL CHART
       chart = new AmCharts.AmSerialChart();

       chart.dataProvider = chartData;
       chart.categoryField = "date";

       // listen for "dataUpdated" event (fired when chart is inited) and call zoomChart method when it happens
       chart.addListener("dataUpdated", zoomChart);

       chart.synchronizeGrid = true; // this makes all axes grid to be at the same intervals

       // AXES
       // category
       var categoryAxis = chart.categoryAxis;
       categoryAxis.parseDates = true; // as our data is date-based, we set parseDates to true
       categoryAxis.minPeriod = "DD"; // our data is daily, so we set minPeriod to DD
       categoryAxis.minorGridEnabled = true;
       categoryAxis.axisColor = "#DADADA";
       categoryAxis.twoLineMode = true;
       categoryAxis.dateFormats = [{
            period: 'fff',
            format: 'JJ:NN:SS'
        }, {
            period: 'ss',
            format: 'JJ:NN:SS'
        }, {
            period: 'mm',
            format: 'JJ:NN'
        }, {
            period: 'hh',
            format: 'JJ:NN'
        }, {
            period: 'DD',
            format: 'DD'
        }, {
            period: 'WW',
            format: 'DD'
        }, {
            period: 'MM',
            format: 'MMM'
        }, {
            period: 'YYYY',
            format: 'YYYY'
        }];
		
		//促销成交数
		<if condition="$con['field_buy_num'] eq 1">
		// first value axis (on the left)
		var valueAxis1 = new AmCharts.ValueAxis();
		valueAxis1.axisColor = "#FF6600";
		valueAxis1.axisThickness = 2;
		chart.addValueAxis(valueAxis1);

		var graph1 = new AmCharts.AmGraph();
		graph1.valueAxis = valueAxis1; // we have to indicate which value axis should be used
		graph1.title = "促销成交数";
		graph1.valueField = "buy_num";
		graph1.bullet = "round";
		graph1.hideBulletsCount = 30;
		graph1.bulletBorderThickness = 1;
		chart.addGraph(graph1);
		</if>
		
		//促销金额
		<if condition="$con['field_buy_money'] eq 1">
		// second value axis (on the right)
		var valueAxis2 = new AmCharts.ValueAxis();
		valueAxis2.offset = 50; // this line makes the axis to appear detached from plot area
		valueAxis2.axisColor = "#FCD202";
		valueAxis2.gridAlpha = 0;
		valueAxis2.axisThickness = 2;
		chart.addValueAxis(valueAxis2);

		// second graph
		var graph2 = new AmCharts.AmGraph();
		graph2.valueAxis = valueAxis2; // we have to indicate which value axis should be used
		graph2.title = "促销金额";
		graph2.valueField = "buy_money";
		graph2.bullet = "round";
		graph2.hideBulletsCount = 30;
		graph2.bulletBorderThickness = 1;
		chart.addGraph(graph2);
		</if>
		
		//广告投放金额
		<if condition="$con['field_ad_money'] eq 1">
		// third value axis (on the left, detached)
		var valueAxis3 = new AmCharts.ValueAxis();
		valueAxis3.offset = 100; // this line makes the axis to appear detached from plot area
		valueAxis3.gridAlpha = 0;
		valueAxis3.axisColor = "#B0DE09";
		valueAxis3.axisThickness = 2;
		chart.addValueAxis(valueAxis3);

		// third graph
		var graph3 = new AmCharts.AmGraph();
		graph3.valueAxis = valueAxis3; // we have to indicate which value axis should be used
		graph3.title = "广告投放金额";
		graph3.valueField = "ad_money";
		graph3.bullet = "round";
		graph3.hideBulletsCount = 30;
		graph3.bulletBorderThickness = 1;
		chart.addGraph(graph3);
		</if>

		//使用优惠券金额
		<if condition="$con['field_coupon_money'] eq 1">
		// third value axis (on the left, detached)
		/*
		var valueAxis4 = new AmCharts.ValueAxis();
		valueAxis4.position = 'right'; // this line makes the axis to appear detached from plot area
		valueAxis4.gridAlpha = 0;
		valueAxis4.axisColor = "#B0DE09";
		valueAxis4.axisThickness = 2;
		chart.addValueAxis(valueAxis4);
*/
		// third graph
		var graph4 = new AmCharts.AmGraph();
		//graph4.valueAxis = valueAxis4; // we have to indicate which value axis should be used
		graph4.valueField = "coupon_money";
		graph4.title = "使用优惠券金额";
		graph4.bullet = "triangleUp";
		graph4.hideBulletsCount = 30;
		graph4.bulletBorderThickness = 1;
		chart.addGraph(graph4);
		</if>


       // CURSOR
       var chartCursor = new AmCharts.ChartCursor();
       chartCursor.cursorAlpha = 0.1;
       chartCursor.fullWidth = true;
       chartCursor.valueLineBalloonEnabled = true;
       chart.addChartCursor(chartCursor);

       // SCROLLBAR
       var chartScrollbar = new AmCharts.ChartScrollbar();
       chart.addChartScrollbar(chartScrollbar);

       // LEGEND
       var legend = new AmCharts.AmLegend();
       legend.marginLeft = 110;
       legend.useGraphSettings = true;
       chart.addLegend(legend);

       // WRITE
       chart.write("chartdiv");
   });

   // generate some random data, quite different range
   function generateChartData() {
       var firstDate = new Date();
       firstDate.setDate(firstDate.getDate() - 50);
	   
	    <volist name="trend_list.data" id="vo">
			var newDate = '{$vo.year}-{$vo.month}-{$vo.day}';
			var buy_num = '{$vo.buy_num}';
			var buy_money = '{$vo.buy_money}';
			var ad_money = '{$vo.ad_money}';
			var coupon_money = '{$vo.coupon_money}';
			
			chartData.push({
				date: newDate,
				buy_num: buy_num,
				buy_money: buy_money,
				ad_money: ad_money,
				coupon_money: coupon_money,
				
			});
		</volist>
/*
       for (var i = 0; i < 50; i++) {
           // we create date objects here. In your data, you can have date strings
           // and then set format of your dates using chart.dataDateFormat property,
           // however when possible, use date objects, as this will speed up chart rendering.
           var newDate = new Date(firstDate);
           newDate.setDate(newDate.getDate() + i);

           var visits = Math.round(Math.random() * 40) + 100;
           var hits = Math.round(Math.random() * 80) + 500;
           var views = Math.round(Math.random() * 6000);


           chartData.push({
               date: newDate,
               visits: visits,
               hits: hits,
               views: views
           });
       }
	   */
   }

   // this method is called when chart is first inited as we listen for "dataUpdated" event
   function zoomChart() {
       // different zoom methods can be used - zoomToIndexes, zoomToDates, zoomToCategoryValues
       chart.zoomToIndexes(10, 20);
   }
</script>
<script>
	//页面页码切换
	function select_change(type,name,new_val){
		var old_val = $('.page_select input[name="'+type+'_'+name+'"]').val();
		if(old_val != new_val){
			$('.page_select input[name="'+type+'_'+name+'"]').val(new_val);
			
			if(name !== 'page'){
				$('.page_select input[name="'+type+'_page"]').val(1);
			}
			$('.page_select').submit();
		}
	}
	function field_change(obj,name){
		if($(obj).is(':checked')){
			console.log(1);
			$('.page_select input[name="field_'+name+'"]').val(1);
		}else{
			console.log(0);
			$('.page_select input[name="field_'+name+'"]').val(0);
		}
	}
</script>
</block>
