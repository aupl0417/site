function imgwh(b,d,c){return b+"?imageMogr2/thumbnail/!"+d+"x"+c+"r/gravity/Center/crop/"+d+"x"+c}template.helper("score",function(b,d){return(b*d*100).toFixed(0)});template.helper("imgwh",function(b,d,c){""==b&&(b="http://img.trj.cc/1469193729000511.png");return imgwh(b,d,c)});function search_isset(b){b.toggleClass("active");$(".select_options").html($(".panel").html())}function select_options(){$(".panel").html($(".select_options").html())}
function select_category(b){$(".panel").html($(".category").html())}function select_category_item(b){var d=b.data("id");b=b.find(".item-title").text();$(".select_options .category_option .item-after").data("id",d).html(b);select_options()}function select_attr(b){$(".panel").html($(".goods_attr").html())}function select_attr_data(b){b=b.data("id");$(".panel").html($('.goods_attr_data [data-id="'+b+'"]').html())}
function select_attr_item(b){var d=b.data("id");b=b.find(".item-title").text();$(".select_options .category_attr .item-after").data("id",d).html(b);select_options()}function select_price(b){$(".panel").html($(".price").html())}function select_price_item(b){var d=b.data("id");b=b.find(".item-title").text();$(".select_options .category_price .item-after").data("id",d).html(b);select_options()}function select_province(b){$(".panel").html($(".province").html())}
function search_goods_select_city(b){var d=b.data("id");""==d?(b=b.find(".item-title").text(),$(".select_options .category_city .item-after").data("id",d).html(b),select_options()):$(".panel").html($('.city [data-id="'+d+'"]').html())}function search_goods_select_city_item(b){var d=b.data("id");b=b.find(".item-title").text();$(".select_options .category_city .item-after").data("id",d).html(b);select_options()}
function search_goods(b){b=$("#page-search-goods").data("cid");var d=$("#page-search-goods").data("q");if(0<$(".select_options .category_city").size())var c=$(".select_options .category_city .item-after").data("id");if(0<$(".select_options .category_option").size())var a=$(".select_options .category_option .item-after").data("id");if(0<$(".select_options .category_attr").size())var e=$(".select_options .category_attr .item-after").data("id");if(0<$(".select_options .category_price").size())var f=
$(".select_options .category_price .item-after").data("id");var g=$('.btn-box [data-val="is_self"]').hasClass("active"),h=$('.btn-box [data-val="is_daigou"]').hasClass("active"),l=$('.btn-box [data-val="free_express"]').hasClass("active"),k=$('.btn-box [data-val="score_ratio"]').hasClass("active");b=a?a:b;var m=a="";switch(f){case 1:m=50;break;case 2:a=50;m=200;break;case 3:a=200;m=500;break;case 4:a=500}$.router.load("/Search/goods"+(b?"/cid/"+b:"")+(c?"/city_id/"+c:"")+(e?"/option/"+e:"")+(a?"/min_price/"+
a:"")+(m?"/max_price/"+m:"")+(g?"/is_self/1":"")+(h?"/is_daigou/1":"")+(l?"/free_express/1":"")+(k?"/score_ratio/2":"")+(d?"/q/"+d:""),!0);$.closePanel()}function getFormJson(b){var d={};b=$(b).serializeArray();$.each(b,function(){void 0!==d[this.name]?(d[this.name].push||(d[this.name]=[d[this.name]]),d[this.name].push(this.value||"")):d[this.name]=this.value||""});return d}
function love(b,d){var c={};d.data("cid")&&(c.cid=d.data("cid"));d.data("num")&&(c.num=d.data("num"));$.get("/Goods/love",c,function(a){1==a.code&&(a=template("tpl_love_goods",{data:a.data}),$(b).html(a))})}
function select_city(b){b.closest("li").addClass("active").siblings().removeClass("active");$(".popup-district ul").html("");$.get("/City/city_item/sid/"+b.data("id"),function(b){1==b.code?(b=template("tpl_district_item",{data:b.data}),$(".popup-district ul").html(b)):$.toast("\u8bfb\u53d6\u57ce\u5e02\u5217\u8868\u5931\u8d25\uff01")})}
function select_district(b){b.closest("li").addClass("active").siblings().removeClass("active");$(".popup-town ul").html("");$.get("/City/city_item/sid/"+b.data("id"),function(b){1==b.code?(b=template("tpl_town_item",{data:b.data}),$(".popup-town ul").html(b)):$.toast("\u8bfb\u53d6\u57ce\u5e02\u5217\u8868\u5931\u8d25\uff01")})}function select_city_item(b){b.closest("li").addClass("active").siblings().removeClass("active")}
function select_city_ok(){var b="",d=".popup-province,.popup-city,.popup-district";$('input[name="province]').val("");$('input[name="city"]').val("");$('input[name="district"]').val("");$('input[name="town"]').val("");0<$(".popup-province ul li.active").size()&&($('input[name="province"]').val($(".popup-province ul li.active .item-link").data("id")),b=$(".popup-province ul li.active .item-title").text());0<$(".popup-city ul li.active").size()&&($('input[name="city"]').val($(".popup-city ul li.active .item-link").data("id")),
b+=" "+$(".popup-city ul li.active .item-title").text());if(0<$(".popup-district ul li.active").size())$('input[name="district"]').val($(".popup-district ul li.active .item-link").data("id")),b+=" "+$(".popup-district ul li.active .item-title").text();else return $.toast("\u8bf7\u9009\u62e9\u533a\u3001\u53bf\uff01"),!1;0<$(".popup-town ul li.active").size()&&($('input[name="town"]').val($(".popup-town ul li.active .item-link").data("id")),b+=" "+$(".popup-town ul li.active .item-title").text(),d+=
",.popup-town");$('input[name="city_name"]').val(b);$.closeModal(d)}
function cancel_fav_goods(b){$.actions([[{text:"\u8bf7\u9009\u62e9",label:!0},{text:"\u6d4f\u89c8\u5546\u54c1",onClick:function(){$.router.load(b.prev().find("a").attr("href"))}},{text:"\u53d6\u6d88\u5173\u6ce8",color:"danger",onClick:function(){$.confirm("\u786e\u5b9a\u8981\u53d6\u6d88\u5173\u6ce8\u5417?",function(){$.post("/FavGoods/delete",{id:b.data("id")},function(d){1==d.code?($.toast("\u5df2\u53d6\u6d88\u5173\u6ce8\uff01"),$("#fav_goods_"+b.data("id")).remove()):$.toast("\u64cd\u4f5c\u5931\u8d25\uff01")})})}}],
[{text:"\u53d6\u6d88",bg:"danger"}]])}
function cancel_fav_shop(b){$.actions([[{text:"\u8bf7\u9009\u62e9",label:!0},{text:"\u8fdb\u5165\u5e97\u94fa",onClick:function(){$.router.load(b.prev().find("a").attr("href"))}},{text:"\u53d6\u6d88\u5173\u6ce8",color:"danger",onClick:function(){$.confirm("\u786e\u5b9a\u8981\u53d6\u6d88\u5173\u6ce8\u5417?",function(){$.post("/FavShop/delete",{id:b.data("id")},function(d){1==d.code?($.toast("\u5df2\u53d6\u6d88\u5173\u6ce8\uff01"),$("#fav_shop_id_"+b.data("id")).remove()):$.toast("\u64cd\u4f5c\u5931\u8d25\uff01")})})}}],
[{text:"\u53d6\u6d88",bg:"danger"}]])}function rate_images_remove(b){$.confirm("\u786e\u5b9a\u8981\u5220\u9664\u7167\u7247\u5417?",function(){var d=b.closest(".upload-box");b.remove();var c=[];d.find(".images-list img").each(function(a){c[a]=$(this).data("images")});d.find("#images").val(c.join(","))})}
function rate_point_option(b){$.actions([[{text:'<img src="/Apps/Mobile/View/default/Public/images/rate-5.png" style="padding-top:0.5rem;">',onClick:function(){b.find(".item-after").html("5\u5206");b.find(b.data("tag")).val(5)}},{text:'<img src="/Apps/Mobile/View/default/Public/images/rate-4.png" style="padding-top:0.5rem;">',onClick:function(){b.find(".item-after").html("4\u5206");b.find(b.data("tag")).val(4)}},{text:'<img src="/Apps/Mobile/View/default/Public/images/rate-3.png" style="padding-top:0.5rem;">',
onClick:function(){b.find(".item-after").html("3\u5206");b.find(b.data("tag")).val(3)}},{text:'<img src="/Apps/Mobile/View/default/Public/images/rate-2.png" style="padding-top:0.5rem;">',onClick:function(){b.find(".item-after").html("2\u5206");b.find(b.data("tag")).val(2)}},{text:'<img src="/Apps/Mobile/View/default/Public/images/rate-1.png" style="padding-top:0.5rem;">',onClick:function(){b.find(".item-after").html("1\u5206");b.find(b.data("tag")).val(1)}}],[{text:"\u53d6\u6d88",bg:"danger"}]])}
function interval_smscode(b){var d=parseInt(b.find(".dec_time").html());1<d?(d--,b.find(".dec_time").html(d)):(d=b.data("timer"),clearInterval(d),b.addClass("active").html("\u53d1\u9001\u9a8c\u8bc1\u7801"))}function top_menu(){$(".fixed-menu").toggleClass("hide");0<$(".category-menu").size()&&0==$(".category-menu").hasClass("hide")&&$(".category-menu").toggleClass("hide")}function category_menu(){$(".category-menu").toggleClass("hide")}
function edit_goods(b){1==b.attr("type")?(b.html("\u5b8c\u6210"),b.attr("type",2)):(b.html("\u7f16\u8f91"),b.attr("type",1));b.closest("ul").find("li .edit-goods").toggleClass("hide")}function sku_num_dec(b){var d=parseInt(b.closest(".item-input").find("#num").val());d--;1>d&&(d=1);b.closest(".item-input").find("#num").val(d)}
function sku_num_inc(b){var d=parseInt(b.closest(".item-input").find("#num").val());d++;var c=b.closest(".item-input").find("#num").data("max_num");d>c&&(d=c);b.closest(".item-input").find("#num").val(d)}
function cart_num_dec(b){var d=parseInt(b.closest("li").find("#num").val()),c=parseInt(b.closest("li").find("#attr_list_id").val());d--;0<d&&$.post("/Cart/dec_num",{id:c},function(a){1==a.code&&(b.closest("li").find(".cart_goods_num").html("x"+d),b.closest("li").find("#num").val(d),cart_total_price())})}
function cart_num_inc(b){var d=parseInt(b.closest("li").find("#num").val()),c=parseInt(b.closest("li").find("#attr_list_id").val());d++;$.post("/Cart/add_num",{id:c},function(a){1==a.code&&(b.closest("li").find(".cart_goods_num").html("x"+d),b.closest("li").find("#num").val(d),cart_total_price())})}
function cart_set_num(b){var d=parseInt(b.closest("li").find("#num").val()),c=parseInt(b.closest("li").find("#attr_list_id").val());$.post("/Cart/set_num",{id:c,num:d},function(a){1==a.code&&(b.closest("li").find(".cart_goods_num").html("x"+d),b.closest("li").find("#num").val(d),cart_total_price())})}
function delete_cart_goods(b){var d=parseInt(b.closest("li").find("#cart_id").val());$.confirm("\u786e\u5b9a\u4ece\u8d2d\u7269\u8f66\u5220\u9664\u8be5\u5546\u54c1\u5417?",function(){$.post("/Cart/delete",{ids:d},function(c){1==c.code?(2<b.closest("ul").children().length?b.closest("li").remove():b.closest("ul").remove(),cart_total_price()):$.toast("\u64cd\u4f5c\u5931\u8d25\uff01")})})}
function cart_total_price(){var b=$("#page-cart"),d=b.find('input[type="checkbox"].check-goods:checked').size();$(".cart-footer .num").html(d);var c=0,a=0;0<b.find('input[type="checkbox"].check-goods:checked').size()?b.find('input[type="checkbox"].check-goods:checked').each(function(){var b=$(this).closest("li").data(),f=$(this).closest("li").find("#price").val(),g=$(this).closest("li").find("#num").val(),f=parseFloat(f*g);c+=f;a=c*b.score_ratio*100;$(".cart-footer .total_price").html(c.toFixed(2));
$(".cart-footer .total_score").html(a.toFixed(2))}):($(".cart-footer .total_price").html(c.toFixed(2)),$(".cart-footer .total_score").html(a.toFixed(2)))}
function set_read(b){var d=b.attr("ids"),c=b.attr("type");$.post("/Notice/set_read",{id:d,is_read:c},function(a){1==a.code?($.toast("\u8bbe\u7f6e\u6210\u529f\uff01"),1==c?($('[data-id="'+d+'"]').find(".yes_read").html("\u6807\u8bb0\u4e3a\u5df2\u8bfb"),$('[data-id="'+d+'"]').find(".yes_read").attr("type",1),$('[data-id="'+d+'"]').find(".card-header").html("\u672a\u9605\u8bfb"),$('[data-id="'+d+'"]').find(".yes_read").removeClass("yes_read").addClass("no_read")):($('[data-id="'+d+'"]').find(".no_read").html("\u6807\u8bb0\u4e3a\u672a\u8bfb"),
$('[data-id="'+d+'"]').find(".no_read").attr("type",0),$('[data-id="'+d+'"]').find(".card-header").html("\u5df2\u9605\u8bfb"),$('[data-id="'+d+'"]').find(".no_read").removeClass(no_read).addClass("yes_read"))):$.toast("\u64cd\u4f5c\u5931\u8d25\uff01")})}
function delete_notice(b){var d=b.attr("ids");$.confirm("\u786e\u5b9a\u5220\u9664\u8be5\u6d88\u606f\u5417?",function(){$.post("/Notice/delete_notice",{id:d},function(b){1==b.code?$('[data-id="'+d+'"]').remove():$.toast("\u64cd\u4f5c\u5931\u8d25\uff01")})})}
function service_accept(b){var d=b.attr("data-r_no"),c=b.attr("data-s_no");$.modal({title:"\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801",text:'<input type="password" class="modal-text-input" name="password_pay">',buttons:[{text:"\u53d6\u6d88"},{text:"\u786e\u5b9a",onClick:function(){var a=$(".modal-text-input").val();if(!a)return $.toast("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801\uff01"),!1;$.post("/Service/service_accept",{r_no:d,s_no:c,password_pay:a},function(a){$.toast(a.msg);1==a.code&&window.location.reload()})}}]})}
function change_attr(b){if(!b.hasClass("not")){b.addClass("selected").siblings().removeClass("selected");var d=[];b.closest(".sku-box").find(".price-btn .selected").each(function(a){d[a]=$(this).data("attr_id")});var c=d.join(","),a=b.data("goods_id");$.post("/Goods/change_attr",{goods_id:a,attr_id:c},function(a){1==a.code?b.closest(".sku-box").html(a.html):$.alert("\u8bfb\u53d6\u5e93\u5b58\u5c5e\u6027\u5931\u8d25\uff01")})}}
function add_to_cart(b){var d=b.data();$.post("/Cart/add",d,function(b){$.toast(b.msg);1==b.code?($(".bar-tab .icon-gouwuche1").html('<span class="badge">'+b.data.style_num+"</span>"),1==d.atonce&&$.router.load("/Cart/selected_goods",!0)):10==b.code&&$.router.load("/Login",!0)})}
function select_to_cart(b){b=b.data();var d=getFormJson("#form_sku_attr");if(1>d.num)return $.toast("\u8bf7\u8f93\u5165\u8ba2\u8d2d\u6570\u91cf\uff01"),!1;if(""==d.attr_list_id)return $.toast("\u5e93\u5b58\u5c5e\u6027\u6709\u9519\u8bef\uff01"),!1;1==b.atonce&&(d.atonce=1);$.post("/Cart/add",d,function(b){$.toast(b.msg);1==b.code?($(".bar-tab .icon-gouwuche1").html('<span class="badge">'+b.data.style_num+"</span>"),1==d.atonce&&($.closeModal(".popup-attr"),$.router.load("/Cart/selected_goods",!0))):
10==b.code&&($.closeModal(".popup-attr"),$.router.load("/Login",!0))})}function refund_num_dec(b){var d=parseInt(b.closest(".item-input").find("input").val()),c=b.closest(".item-input").find("input").data("max"),a=b.closest(".item-input").find("input").data("unit_price");d||(d=1);d--;1>d&&(d=1);d>c&&(d=c);b.closest(".item-input").find("input").val(d);$(".refund_price").html(d*a)}
function refund_num_inc(b){var d=parseInt(b.closest(".item-input").find("input").val()),c=b.closest(".item-input").find("input").data("max"),a=b.closest(".item-input").find("input").data("unit_price");d||(d=1);d++;1>d&&(d=1);d>c&&(d=c);b.closest(".item-input").find("input").val(d);$(".refund_price").html(d*a)}
function refund_set_num(b){var d=b.val(),c=b.attr("data-max"),a=b.attr("data-unit_price");if(!parseInt(d))return $.toast("\u5546\u54c1\u6570\u91cf\u53ea\u80fd\u662f\u6574\u6570"),!1;if(d>c)return $.toast("\u9000\u56de\u6570\u91cf\u5927\u4e8e\u53ef\u9000\u7684\u5546\u54c1\u6570\u91cf"),b.val(c),!1;$(".refund_price").html(d*a)}function get_cookie_url(b){var d=$.fn.cookie("history");if(d){var d=d.split(","),c=d.length;void 0==b&&(b=c-2);return d[b]}}
function goback(b){void 0==b&&(b=!1);b?(b=get_cookie_url())?$.router.load(b,!0):$.router.back():$.router.back()}function get_coupon(b){b=b.data();$.post("/Coupon/get_coupon",b,function(b){10==b.code?$.router.load("/Login"):$.alert(b.msg)})}
$(function(){$(document).on("pageInit",".page",function(b,d,c){b=c[0].baseURI;d=(d=$.fn.cookie("history"))?d.split(","):[];c=d.length;if(5<c)for(var a=0;a<c-5;a++)d.shift();d.push(b);$.fn.cookie("history",d.join(","))});$(document).on("pageInit","#page-home",function(b,d,c){function a(a){$.get(g,{p:a},function(a){1==a.code&&(a=template(h,{data:a.data.list}),$(".infinite-scroll .list-container").append(a))})}var e=!1;b=c.data("page_num");var f=100<b?100:b,g=c.data("url"),h=c.data("tpl");$(".infinite-scroll-preloader").hide();
$(c).on("infinite",function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))})});$(document).on("pageInit","#page-login",function(b,d,c){$(".btn-login").click(function(){var a=getFormJson("#form-login");if(""==a.username||""==a.password)return $.toast("\u8bf7\u8f93\u5165\u6635\u79f0\u6216\u624b\u673a\u53f7\u7801\uff01"),
!1;if(1==$(".code").attr("data_id")&&""==a.code)return $.toast("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801\uff01"),!1;$.post("/Login/check_login",a,function(a){1==a.code?location.href="/Ucenter":($.toast(a.msg),$(".code").removeClass("hide"),$(".code").attr("data_id",1),$(".verify img").attr("src","/Login/code/h/40?id="+ +Math.random()))})});$(".verify").click(function(){$(".verify img").attr("src","/Login/code/h/40?id="+ +Math.random())})});$(document).on("pageInit","#page-fav-goods",function(b,d,c){function a(a){$.get(g,
{p:a},function(a){a=template(h,{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}var e=!1;b=c.data("page_num");var f=100<b?100:b,g=c.data("url"),h=c.data("tpl");$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))})});
$(document).on("pageInit","#page-fav-shop",function(b,d,c){function a(a){$.get(g,{p:a},function(a){a=template(h,{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}var e=!1;b=c.data("page_num");var f=100<b?100:b,g=c.data("url"),h=c.data("tpl");$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").hide()):
(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))})});$(document).on("pageInit","#page-scroll-hot",function(b,d,c){function a(a){$.get("/Hot/hot_page",{p:a},function(a){a=template("tpl_hot_item",{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}var e=!1;b=c.data("page_num");var f=100<b?100:b;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),
$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))})});$(document).on("pageInit","#page-ucenter",function(b,d,c){$(".to-account").click(function(){$.toast("\u8d26\u6237\u8be6\u60c5\u8bf7\u767b\u5f55PC\u7aef\u6216APP\u67e5\u770b\uff01")});$(".btn-logout").click(function(){$.get("/Login/logout",function(a){1==a.code?($.toast("\u5df2\u6210\u529f\u767b\u51fa\uff01"),setTimeout(function(){location.href="/Login"},1E3)):$.toast("\u767b\u51fa\u5931\u8d25\uff01")})})});
$(document).on("pageInit","#page-shopping-address",function(b,d,c){function a(a){$.get("/ShoppingAddress/address_page",{p:a},function(a){a=template("tpl_address_item",{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}var e=!1;b=c.data("page_num");var f=100<b?100:b;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),
$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))});$(c).on("click",".action",function(){var a=$(this);$.actions([[{text:"\u8bf7\u9009\u62e9",label:!0},{text:"\u4fee\u6539",onClick:function(){$.router.load("/ShoppingAddress/edit/id/"+a.data("id"),!0)}},{text:"\u5220\u9664",color:"danger",onClick:function(){$.confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417?",function(){$.post("/ShoppingAddress/delete",{id:a.data("id")},function(b){1==b.code&&($.toast("\u5220\u9664\u6210\u529f\uff01"),
$("#address-"+a.data("id")).remove())})})}},{text:"\u8bbe\u4e3a\u9ed8\u8ba4",onClick:function(){$.post("/ShoppingAddress/set_default",{id:a.data("id")},function(a){1==a.code?($.toast("\u8bbe\u7f6e\u6210\u529f\uff01"),$.router.load("/ShoppingAddress/index/random/"+Math.random(),!0)):$.toast("\u8bbe\u7f6e\u5931\u8d25\uff01")})}}],[{text:"\u53d6\u6d88",bg:"danger"}]])})});$(document).on("pageInit","#page-shopping-address-add,#page-shopping-address-edit",function(b,d,c){$(".btn-submit").click(function(){var a=
getFormJson("#form-shopaddress-add");if(""==a.linkname)return $.toast("\u8bf7\u8f93\u5165\u8054\u7cfb\u4eba\uff01"),!1;if(""==a.mobile&&""==a.tel)return $.toast("\u624b\u673a\u53f7\u7801\u6216\u7535\u8bdd\u53f7\u7801\u4e24\u9879\u5fc5\u987b\u586b\u5199\u4e00\u9879\uff01"),!1;if(""==a.province||""==a.city||""==a.district)return $.toast("\u8bf7\u9009\u62e9\u57ce\u5e02\uff01"),!1;if(""==a.street)return $.toast("\u8bf7\u8f93\u5165\u8be6\u7ec6\u5730\u5740\uff01"),!1;var b=c.find("form").attr("action");
$.post(b,a,function(a){1==a.code?$.router.load("/ShoppingAddress",!0):$.toast(a.msg)})});$(".popup-province .open-popup").click(function(){$(this).closest("li").addClass("active").siblings().removeClass("active");$(".popup-city ul").html("");$.get("/City/city_item/sid/"+$(this).data("id"),function(a){1==a.code?(a=template("tpl_city_item",{data:a.data}),$(".popup-city ul").html(a)):$.toast("\u8bfb\u53d6\u57ce\u5e02\u5217\u8868\u5931\u8d25\uff01")})})});$(document).on("pageInit","#page-register-person",
function(b,d,c){$(".smscode.active").click(function(){var a=$(this);if(0!=a.hasClass("active")){var b=getFormJson("#form-register-person");if(""==b.mobile)return $.toast("\u8bf7\u5148\u8f93\u5165\u624b\u673a\u53f7\u7801\uff01"),!1;$.post("/Login/smscode",{mobile:b.mobile},function(b){1==b.code?(a.removeClass("active").html('<span class="dec_time">180</span>\u79d2\u540e\u91cd\u65b0\u83b7\u53d6'),b=window.setInterval(function(){interval_smscode(a)},1E3),a.data("timer",b)):$.toast(b.msg)})}});$(".btn-submit").click(function(){var a=
getFormJson("#form-register-person");if(""==a.username)return $.toast("\u8bf7\u8f93\u5165\u6635\u79f0"),!1;if(6>a.username.length)return $.toast("\u7528\u6237\u540d\u5fc5\u987b\u662f6~20\u4f4d,\u4e0d\u80fd\u4ee5_\u6216\u6570\u5b57\u5f00\u5934,\u4e0d\u80fd\u4ee5_\u7ed3\u675f"),!1;if(""==a.password)return $.toast("\u8bf7\u8f93\u5165\u5bc6\u7801\uff01"),!1;if(8>a.password.length)return $.toast("\u5bc6\u7801\u957f\u5ea6\u4e0d\u5c11\u4e8e8\u4f4d"),!1;if(""==a.mobile)return $.toast("\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u7801\uff01"),
!1;if(""==a.smscode)return $.toast("\u8bf7\u8f93\u5165\u77ed\u4fe1\u9a8c\u8bc1\u7801\uff01"),!1;if(1!=a.is_accept)return $.toast("\u8bf7\u9605\u8bfb\u5e76\u540c\u610f\u4f1a\u5458\u6ce8\u518c\u534f\u8bae\uff01"),!1;$.post("/Login/register_person_save",a,function(a){1==a.code?$.router.load("/Ucenter",!0):$.toast(a.msg)})});$(".switch-eye").click(function(){"password"==$(this).closest("li").find("input").attr("type")?($(this).find("i").removeClass("icon-Untitled-").addClass("icon-eye"),$(this).closest("li").find("input").attr("type",
"text")):($(this).find("i").removeClass("icon-eye").addClass("icon-Untitled-"),$(this).closest("li").find("input").attr("type","password"))});$('input[name="mobile"]').blur(function(){if(""==getFormJson("#form-register-person").mobile)return!1;$.post("/Login/check_mobile",{mobile:$(this).val()},function(a){$.toast(a.msg);$(this).data("status",a.code)})});$('input[name="username"]').blur(function(){var a=getFormJson("#form-register-person");if(""==a.username)return $.toast("\u8bf7\u8f93\u5165\u7528\u6237\u6635\u79f0\uff01"),
!1;$.post("/Login/check_username",{username:$(this).val(),referrer:a.ref},function(a){1==a.code?$.toast("\u7528\u6237\u540d\u53ef\u7528\uff01"):$.toast(a.msg)})});$('input[name="ref"]').blur(function(){var a=$(this),b=getFormJson("#form-register-person");if(""==b.ref)return $.toast("\u8bf7\u8f93\u5165\u5206\u4eab\u4eba\u6635\u79f0\u6216\u624b\u673a\u53f7\u7801\uff01"),!1;$.post("/Login/check_username",{username:b.username,referrer:b.ref},function(b){1==b.code?(b="\u6635\u79f0\uff1a"+b.data.u_nick+
(b.data.u_tel?" \u624b\u673a\uff1a"+b.data.u_tel:""),$(".ref_user").removeClass("hide").find(".item-inner").html(b)):($.toast("\u5206\u4eab\u4eba\u4e0d\u5b58\u5728\uff01"),a.val(""),$(".ref_user").addClass("hide").find(".item-inner").html(""))})})});$(document).on("pageInit","#page-register-company",function(b,d,c){$(".smscode.active").click(function(){var a=$(this);if(0!=a.hasClass("active")){var b=getFormJson("#form-register-company");if(""==b.mobile)return $.toast("\u8bf7\u5148\u8f93\u5165\u624b\u673a\u53f7\u7801\uff01"),
!1;$.post("/Login/smscode",{mobile:b.mobile},function(b){1==b.code?(a.removeClass("active").html('<span class="dec_time">180</span>\u79d2\u540e\u91cd\u65b0\u83b7\u53d6'),b=window.setInterval(function(){interval_smscode(a)},1E3),a.data("timer",b)):$.toast(b.msg)})}});$(".btn-submit").click(function(){var a=getFormJson("#form-register-company");if(""==a.username)return $.toast("\u8bf7\u8f93\u5165\u6635\u79f0"),!1;if(6>a.username.length)return $.toast("6~20\u4f4d,\u4e0d\u80fd\u4ee5_\u6216\u6570\u5b57\u5f00\u5934,\u4e0d\u80fd\u4ee5_\u7ed3\u675f"),
!1;if(""==a.password)return $.toast("\u8bf7\u8f93\u5165\u5bc6\u7801\uff01"),!1;if(8>a.password.length)return $.toast("\u5bc6\u7801\u957f\u5ea6\u4e0d\u5c11\u4e8e8\u4f4d"),!1;if(""==a.mobile)return $.toast("\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u7801\uff01"),!1;if(""==a.smscode)return $.toast("\u8bf7\u8f93\u5165\u77ed\u4fe1\u9a8c\u8bc1\u7801\uff01"),!1;if(""==a.organize)return $.toast("\u8bf7\u9009\u62e9\u7ec4\u7ec7\u673a\u6784\u7c7b\u578b\uff01"),!1;if(""==a.company)return $.toast("\u8bf7\u8f93\u5165\u516c\u53f8\u540d\u79f0\uff01"),
!1;if(""==a.company_license)return $.toast("\u8bf7\u8f93\u5165\u8425\u4e1a\u6267\u7167\uff01"),!1;if(1!=a.is_accept)return $.toast("\u8bf7\u9605\u8bfb\u5e76\u540c\u610f\u4f1a\u5458\u6ce8\u518c\u534f\u8bae\uff01"),!1;$.post("/Login/register_company_save",a,function(a){1==a.code?$.router.load("/Ucenter",!0):$.toast(a.msg)})});$(".switch-eye").click(function(){"password"==$(this).closest("li").find("input").attr("type")?($(this).find("i").removeClass("icon-Untitled-").addClass("icon-eye"),$(this).closest("li").find("input").attr("type",
"text")):($(this).find("i").removeClass("icon-eye").addClass("icon-Untitled-"),$(this).closest("li").find("input").attr("type","password"))});$(".popup-stru ul li .item-link").click(function(){var a=$(this).data("id");$('input[name="organize"]').val(a);$('input[name="organize_name"]').val($(this).find(".item-title").text());$.closeModal(".popup-stru")});$('input[name="mobile"]').blur(function(){if(""==getFormJson("#form-register-company").mobile)return!1;$.post("/Login/check_mobile",{mobile:$(this).val()},
function(a){$.toast(a.msg);$(this).data("status",a.code)})});$('input[name="username"]').blur(function(){if(""==getFormJson("#form-register-company").username)return $.toast("\u8bf7\u8f93\u5165\u7528\u6237\u6635\u79f0\uff01"),!1;$.post("/Login/check_username",{username:$(this).val()},function(a){1==a.code?$.toast("\u7528\u6237\u540d\u53ef\u7528\uff01"):$.toast(a.msg)})});$('input[name="ref"]').blur(function(){var a=$(this),b=getFormJson("#form-register-company");if(""==b.ref)return $.toast("\u8bf7\u8f93\u5165\u5206\u4eab\u4eba\u6635\u79f0\u6216\u7535\u8bdd\u53f7\u7801\uff01"),
!1;$.post("/Login/check_username",{username:b.username,referrer:b.ref},function(b){1==b.code?(b="\u6635\u79f0\uff1a"+b.data.u_nick+(b.data.u_tel?" \u624b\u673a\uff1a"+b.data.u_tel:""),$(".ref_user").removeClass("hide").find(".item-inner").html(b)):($.toast("\u5206\u4eab\u4eba\u4e0d\u5b58\u5728\uff01"),a.val(""),$(".ref_user").addClass("hide").find(".item-inner").html(""))})})});$(document).on("pageInit","#page-forget",function(b,d,c){$(".smscode.active").click(function(){var a=$(this);if(0!=a.hasClass("active")){var b=
getFormJson("#form-forget");if(""==b.username)return $.toast("\u8bf7\u5148\u7528\u6237\u6635\u79f0\uff01"),!1;if(""==b.mobile)return $.toast("\u8bf7\u5148\u8f93\u5165\u624b\u673a\u53f7\u7801\uff01"),!1;$.post("/Login/smscode",{mobile:b.mobile,username:b.username},function(b){1==b.code?(a.removeClass("active").html('<span class="dec_time">180</span>\u79d2\u540e\u91cd\u65b0\u83b7\u53d6'),b=window.setInterval(function(){interval_smscode(a)},1E3),a.data("timer",b)):$.toast(b.msg)})}});$(".btn-submit").click(function(){var a=
getFormJson("#form-forget");if(""==a.username)return $.toast("\u8bf7\u8f93\u5165\u6635\u79f0"),!1;if(6>a.username.length)return $.toast("\u7528\u6237\u540d\u5fc5\u987b\u662f6~20\u4f4d\u4e4b\u95f4\u7684\u4e2d\u6587/\u5b57\u6bcd/\u6570\u5b57/\u4e0b\u5212\u7ebf\u7ec4\u5408"),!1;if(""==a.mobile)return $.toast("\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u7801\uff01"),!1;if(""==a.smscode)return $.toast("\u8bf7\u8f93\u5165\u77ed\u4fe1\u9a8c\u8bc1\u7801\uff01"),!1;if(6>a.smscode.length)return $.toast("\u77ed\u4fe1\u9a8c\u8bc1\u7801\u53ea\u80fd\u662f6\u4f4d\u7eaf\u6570\u5b57\uff01"),
!1;$.post("/Login/forget_step1",a,function(a){1==a.code?($.toast("\u8bf7\u8f93\u5165\u60a8\u7684\u65b0\u5bc6\u7801\uff01"),$.router.load("/Login/forget_step2/erp_uid/"+a.data.userID+"/signcode/"+a.data.sign,!0)):$.toast(a.msg)})})});$(document).on("pageInit","#page-forget2",function(b,d,c){$(".btn-submit").click(function(){var a=getFormJson("#form-forget2");if(""==a.password)return $.toast("\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801"),!1;if(""==a.password2)return $.toast("\u8bf7\u8f93\u5165\u786e\u8ba4\u5bc6\u7801\uff01"),
!1;if(8>a.password.length)return $.toast("\u65b0\u5bc6\u7801\u4e0d\u80fd\u5c11\u4e8e8\u4f4d"),!1;if(a.password!=a.password2)return $.toast("\u65b0\u5bc6\u7801\u548c\u786e\u8ba4\u5bc6\u7801\u4e0d\u4e00\u81f4"),!1;$.post("/Login/save_forget_step2",a,function(a){1==a.code?($.toast("\u5bc6\u7801\u4fee\u6539\u6210\u529f\uff01"),$.router.load("/Login",!0)):$.toast(a.msg)})})});$(document).on("pageInit","#page-category-goods",function(b,d,c){});$(document).on("pageInit","#page-search",function(b,d,c){$(".btn-search").click(function(){var a=
$('input[name="q"]').val();if(""==a)return $.toast("\u8bf7\u8f93\u5165\u5173\u952e\u8bcd\uff01"),!1;$.router.load("/Search/goods/q/"+a,!0)})});$(document).on("pageInit","#page-search-goods",function(b,d,c){function a(a){var b={};b.p=a;c.data("cid")&&(b.cid=c.data("cid"));c.data("sort")&&(b.sort=c.data("sort"));c.data("city_id")&&(b.option=c.data("city_id"));c.data("is_self")&&(b.is_self=c.data("is_self"));c.data("is_daigou")&&(b.is_daigou=c.data("is_daigou"));c.data("free_express")&&(b.free_express=
c.data("free_express"));c.data("score_ratio")&&(b.score_ratio=c.data("score_ratio"));c.data("q")&&(b.q=c.data("q"));c.data("min_price")&&(b.min_price=c.data("min_price"));c.data("max_price")&&(b.min_price=c.data("max_price"));c.data("option")&&(b.option=c.data("option"));$.get("/Search/goods_page",b,function(a){a=template("tpl_goods_item",{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}var e=!1;b=c.data("page_num");var f=100<b?100:b;$(".infinite-scroll-preloader").hide();$(c).on("infinite",
function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))});$(".open-panel").click(function(){$(".panel").html($(".select_options").html())})});$(document).on("pageInit","#page-goods-view",function(b,d,c){0<=get_cookie_url().indexOf("/Goods/view")&&c.find(".content").scrollTop(0);$("#ac-fav").click(function(){var a=
$(this);$.post("/Goods/fav_toggle",{goods_id:$(this).data("goods_id")},function(b){$.toast(b.msg);0<b.code&&a.find("i").toggleClass("text-red")})})});$(document).on("pageInit","#page-goods-content",function(b,d,c){c.find(".content").scrollTop(0)});$(document).on("pageInit","#page-goods-rate",function(b,d,c){function a(a,b){a={p:a,goods_id:f};1==b?a.level=1:2==b?a.level=0:3==b&&(a.level=-1);$.get("/Goods/rate_page",a,function(a){a=template("tpl_goods_rate",{data:a.data.list});$(".infinite-scroll").eq(b).find(".list-container").append(a)})}
var e=!1,f=c.data("goods_id");$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($(".infinite-scroll").eq(0).find("#p").val()),d=parseInt($(".infinite-scroll").eq(1).find("#p").val()),f=parseInt($(".infinite-scroll").eq(2).find("#p").val()),k=parseInt($(".infinite-scroll").eq(3).find("#p").val());e||(e=!0,c.find(".infinite-scroll.active .infinite-scroll-preloader").show(),setTimeout(function(){e=!1;var g=0,h=c.find(".infinite-scroll.active").data("page_num"),l=b;"tab2"==
c.find(".infinite-scroll.active").attr("id")&&(g=1,l=d);"tab3"==c.find(".infinite-scroll.active").attr("id")&&(g=2,l=f);"tab4"==c.find(".infinite-scroll.active").attr("id")&&(g=3,l=k);if(l>h)c.find(".infinite-scroll.active .infinite-scroll-preloader").hide();else{a(l,g);switch(g){case 1:d++;$(".infinite-scroll").eq(g).find("#p").val(d);break;case 2:f++;$(".infinite-scroll").eq(g).find("#p").val(f);break;case 3:k++;$(".infinite-scroll").eq(g).find("#p").val(k);break;default:b++,$(".infinite-scroll").eq(g).find("#p").val(last_sale)}$.refreshScroller()}},
1E3))})});$(document).on("pageInit","#page-shop-best",function(b,d,c){function a(a){$.get("/Shop/best_page",{p:a,shop_id:g},function(a){a=template("tpl_shop_goods",{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}var e=!1;b=c.data("page_num");var f=100<b?100:b,g=c.data("shop_id");$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),
$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))})});$(document).on("pageInit","#page-goods-content",function(b,d,c){c.find(".content").scrollTop(0)});$(document).on("pageInit",".shop-goods-list",function(b,d,c){function a(a,b){a={p:a,shop_id:e};1==b?a.order="sale_num desc":2==b?a.order="view desc":3==b&&(a.order=$(".buttons-tab a").eq(b).data("order"));var d=c.find('input[name="sid"]').val(),f=c.find('input[name="q"]').val();""!=d&&(a.sid=d);""!=f&&(a.q=
f);$.get("/Shop/goods_page",a,function(a){a=template("tpl_shop_goods",{data:a.data.list});$(".infinite-scroll").eq(b).find(".list-container").append(a)})}var e=c.data("shop_id");$(".buttons-tab a").eq(3).click(function(){var a=$(this).data("order");if(1==$(this).data("status")){a="price asc"==a?"price desc":"price asc";$(this).data("order",a);var b=c.find('input[name="sid"]').val(),d=c.find('input[name="q"]').val(),a={shop_id:e,order:a};""!=b&&(a.sid=b);""!=d&&(a.q=d);$.get("/Shop/goods_page",a,function(a){a=
template("tpl_shop_goods",{data:a.data.list});$(".infinite-scroll").eq(3).find(".list-container").html(a)})}else $(this).data("status",1)});$(".buttons-tab a").not('[href="#tab4"]').click(function(){$(".buttons-tab a").eq(3).data("status",0)});var f=!1;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($(".infinite-scroll").eq(0).find("#p").val()),d=parseInt($(".infinite-scroll").eq(1).find("#p").val()),e=parseInt($(".infinite-scroll").eq(2).find("#p").val()),k=parseInt($(".infinite-scroll").eq(3).find("#p").val());
f||(f=!0,c.find(".infinite-scroll.active .infinite-scroll-preloader").show(),setTimeout(function(){f=!1;var g=0,h=c.find(".infinite-scroll.active").data("page_num"),l=b;"tab2"==c.find(".infinite-scroll.active").attr("id")&&(g=1,l=d);"tab3"==c.find(".infinite-scroll.active").attr("id")&&(g=2,l=e);"tab4"==c.find(".infinite-scroll.active").attr("id")&&(g=3,l=k);if(l>h)c.find(".infinite-scroll.active .infinite-scroll-preloader").hide();else{a(l,g);switch(g){case 1:d++;$(".infinite-scroll").eq(g).find("#p").val(d);
break;case 2:e++;$(".infinite-scroll").eq(g).find("#p").val(e);break;case 3:k++;$(".infinite-scroll").eq(g).find("#p").val(k);break;default:b++,$(".infinite-scroll").eq(g).find("#p").val(b)}$.refreshScroller()}},1E3))})});$(document).on("pageInit","#page-shop-index",function(b,d,c){$("#ac-fav").click(function(){var a=$(this);$.post("/Shop/fav_toggle",{shop_id:$(this).data("shop_id")},function(b){$.toast(b.msg);0<b.code&&a.find("i").toggleClass("text-red")})})});$(document).on("pageInit","#page-shop-contact",
function(b,d,c){$("#ac-fav").click(function(){var a=$(this);$.post("/Shop/fav_toggle",{shop_id:$(this).data("shop_id")},function(b){$.toast(b.msg);0<b.code&&a.find("i").toggleClass("text-red")})})});$(document).on("pageInit","#page-shop-rate",function(b,d,c){function a(a,b){a={p:a,shop_id:f};1==b?a.level=1:2==b?a.level=0:3==b&&(a.level=-1);$.get("/Shop/rate_page",a,function(a){a=template("tpl_shop_rate",{data:a.data.list});$(".infinite-scroll").eq(b).find(".list-container").append(a)})}$("#ac-fav").click(function(){var a=
$(this);$.post("/Shop/fav_toggle",{shop_id:$(this).data("shop_id")},function(b){$.toast(b.msg);0<b.code&&a.find("i").toggleClass("text-red")})});var e=!1,f=c.data("shop_id");$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($(".infinite-scroll").eq(0).find("#p").val()),d=parseInt($(".infinite-scroll").eq(1).find("#p").val()),f=parseInt($(".infinite-scroll").eq(2).find("#p").val()),k=parseInt($(".infinite-scroll").eq(3).find("#p").val());e||(e=!0,c.find(".infinite-scroll.active .infinite-scroll-preloader").show(),
setTimeout(function(){e=!1;var g=0,h=c.find(".infinite-scroll.active").data("page_num"),l=b;"tab2"==c.find(".infinite-scroll.active").attr("id")&&(g=1,l=d);"tab3"==c.find(".infinite-scroll.active").attr("id")&&(g=2,l=f);"tab4"==c.find(".infinite-scroll.active").attr("id")&&(g=3,l=k);if(l>h)c.find(".infinite-scroll.active .infinite-scroll-preloader").hide();else{a(l,g);switch(g){case 1:d++;$(".infinite-scroll").eq(g).find("#p").val(d);break;case 2:f++;$(".infinite-scroll").eq(g).find("#p").val(f);
break;case 3:k++;$(".infinite-scroll").eq(g).find("#p").val(k);break;default:b++,$(".infinite-scroll").eq(g).find("#p").val(b)}$.refreshScroller()}},1E3))})});$(document).on("pageInit","#page-shop-category",function(b,d,c){$('input[name="q"]').blur(function(){var a=$('input[name="q"]').val();if(""==a)return $.toast("\u8bf7\u8f93\u5165\u5173\u952e\u8bcd\uff01"),!1;var b=c.data("shop_id");$.router.load("/Shop/goods/shop_id/"+b+"/q/"+a,!0)})});$(document).on("pageInit","#page-edit-login-password",function(b,
d,c){$(".smscode.active").click(function(){var a=$(this);0!=a.hasClass("active")&&$.post("/User/send_code",function(b){1==b.code?(a.removeClass("active").html('<span class="dec_time">180</span>\u79d2\u540e\u91cd\u65b0\u83b7\u53d6'),b=window.setInterval(function(){interval_smscode(a)},1E3),a.data("timer",b)):$.toast(b.msg)})});$(".btn-submit").click(function(){var a=getFormJson("#form-edit-password");if(""==a.opassword)return $.toast("\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801"),!1;if(8>a.opassword.length)return $.toast("\u767b\u5f55\u5bc6\u7801\u4e0d\u80fd\u5c11\u4e8e8\u4f4d"),
!1;if(""==a.smscode)return $.toast("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801\uff01"),!1;if(6>a.smscode.length)return $.toast("\u9a8c\u8bc1\u7801\u53ea\u80fd\u662f6\u4f4d\u7eaf\u6570\u5b57"),!1;if(""==a.password)return $.toast("\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801\uff01"),!1;if(""==a.password2)return $.toast("\u8bf7\u8f93\u5165\u786e\u8ba4\u5bc6\u7801\uff01"),!1;if(8>a.password.length)return $.toast("\u65b0\u5bc6\u7801\u4e0d\u80fd\u5c11\u4e8e8\u4f4d"),!1;if(a.password!=a.password2)return $.toast("\u65b0\u5bc6\u7801\u548c\u786e\u8ba4\u5bc6\u7801\u4e0d\u4e00\u81f4"),
!1;$.post("/User/save_login_password",a,function(a){1==a.code?($.toast("\u4fee\u6539\u5bc6\u7801\u6210\u529f\uff01"),$.router.load("/Setting",!0)):$.toast(a.msg)})})});$(document).on("pageInit","#page-edit-set-password",function(b,d,c){$(".smscode.active").click(function(){var a=$(this);0!=a.hasClass("active")&&$.post("/User/send_code",function(b){1==b.code?(a.removeClass("active").html('<span class="dec_time">180</span>\u79d2\u540e\u91cd\u65b0\u83b7\u53d6'),b=window.setInterval(function(){interval_smscode(a)},
1E3),a.data("timer",b)):$.toast(b.msg)})});$(".btn-submit").click(function(){var a=getFormJson("#form-set-password");if(""==a.smscode)return $.toast("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801\uff01"),!1;if(6>a.smscode.length)return $.toast("\u9a8c\u8bc1\u7801\u53ea\u80fd\u662f6\u4f4d\u7eaf\u6570\u5b57"),!1;if(""==a.password)return $.toast("\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801\uff01"),!1;if(""==a.password2)return $.toast("\u8bf7\u8f93\u5165\u786e\u8ba4\u5bc6\u7801\uff01"),!1;if(6>a.password.length)return $.toast("\u65b0\u5b89\u5168\u5bc6\u7801\u53ea\u80fd\u662f6\u4f4d\u7eaf\u6570\u5b57"),
!1;if(a.password!=a.password2)return $.toast("\u65b0\u5b89\u5168\u5bc6\u7801\u548c\u786e\u8ba4\u5b89\u5168\u5bc6\u7801\u4e0d\u4e00\u81f4"),!1;$.post("/User/save_set_password",a,function(a){1==a.code?($.toast("\u8bbe\u7f6e\u5b89\u5168\u5bc6\u7801\u6210\u529f\uff01"),$.router.load("/Setting",!0)):$.toast(a.msg)})})});$(document).on("pageInit","#page-edit-safe-password",function(b,d,c){$(".smscode.active").click(function(){var a=$(this);0!=a.hasClass("active")&&$.post("/User/send_code",function(b){1==
b.code?(a.removeClass("active").html('<span class="dec_time">180</span>\u79d2\u540e\u91cd\u65b0\u83b7\u53d6'),b=window.setInterval(function(){interval_smscode(a)},1E3),a.data("timer",b)):$.toast(b.msg)})});$(".btn-submit").click(function(){var a=getFormJson("#form-edit-password");if(""==a.opassword)return $.toast("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801"),!1;if(6>a.opassword.length)return $.toast("\u5b89\u5168\u5bc6\u7801\u53ea\u80fd\u662f6\u4f4d\u7eaf\u6570\u5b57"),!1;if(""==a.smscode)return $.toast("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801\uff01"),
!1;if(6>a.smscode.length)return $.toast("\u9a8c\u8bc1\u7801\u53ea\u80fd\u662f6\u4f4d\u7eaf\u6570\u5b57"),!1;if(""==a.password)return $.toast("\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801\uff01"),!1;if(""==a.password2)return $.toast("\u8bf7\u8f93\u5165\u786e\u8ba4\u5bc6\u7801\uff01"),!1;if(6>a.password.length)return $.toast("\u65b0\u5b89\u5168\u5bc6\u7801\u53ea\u80fd\u662f6\u4f4d\u7eaf\u6570\u5b57"),!1;if(a.password!=a.password2)return $.toast("\u65b0\u5b89\u5168\u5bc6\u7801\u548c\u786e\u8ba4\u5b89\u5168\u5bc6\u7801\u4e0d\u4e00\u81f4"),
!1;$.post("/User/save_safe_password",a,function(a){1==a.code?($.toast("\u4fee\u6539\u5b89\u5168\u5bc6\u7801\u6210\u529f\uff01"),$.router.load("/Setting",!0)):$.toast(a.msg)})})});$(document).on("pageInit","#page-cart",function(b,d,c){function a(){$('input[type="checkbox"].check-goods').each(function(){0<$(this).closest("ul").find('input[type="checkbox"].check-goods:checked').size()?$(this).closest("ul").find('input[name="express_tpl_id"]').prop("checked",!0):$(this).closest("ul").find('input[name="express_tpl_id"]').prop("checked",
!1)})}function e(){var a=c.find('input[type="checkbox"].check-goods:checked').size();$(".cart-footer .num").html(a);var b=0,d=0;0<c.find('input[type="checkbox"].check-goods:checked').size()?c.find('input[type="checkbox"].check-goods:checked').each(function(){var a=$(this).closest("li").data(),c=$(this).closest("li").find("#price").val(),f=$(this).closest("li").find("#num").val(),c=parseFloat(c*f);b+=c;d=b*a.score_ratio*100;$(".cart-footer .total_price").html(b.toFixed(2));$(".cart-footer .total_score").html(d.toFixed(2))}):
($(".cart-footer .total_price").html(b.toFixed(2)),$(".cart-footer .total_score").html(d.toFixed(2)))}a();e();$('input[name="express_tpl_id"]').change(function(){if(1==$(this).is(":checked")){$(this).closest("ul").find('input[type="checkbox"]').not('input[disabled="disabled"]').prop("checked",!0);var a=$(this).closest("ul").find('input[disabled="disabled"].check-goods').size();0==$(this).closest("ul").find('input[type="checkbox"].check-goods').size()-a&&$(this).closest("ul").find('input[type="checkbox"]').prop("checked",
!1)}else $(this).closest("ul").find('input[type="checkbox"]').not('input[disabled="disabled"]').prop("checked",!1);e()});$('input[type="checkbox"].check-goods').change(function(){0<$(this).closest("ul").find('input[type="checkbox"].check-goods:checked').size()?$(this).closest("ul").find('input[name="express_tpl_id"]').prop("checked",!0):$(this).closest("ul").find('input[name="express_tpl_id"]').prop("checked",!1);e()});$(".check-all").change(function(){1==$(this).is(":checked")?c.find('input[type="checkbox"]').not('input[disabled="disabled"]').prop("checked",
!0):c.find('input[type="checkbox"]').not('input[disabled="disabled"]').prop("checked",!1);a();e()});$(".btn-submit").click(function(){if(1>c.find('input[type="checkbox"].check-goods:checked').size())$.toast("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u9879\u5546\u54c1\uff01");else{var a=getFormJson("#form-cart");$.post("/Cart/set_selected",a,function(a){1==a.code?window.location.href="/Cart/selected_goods":10==a.code?$.router.load("/Login"):$.alert(a.msg)})}})});$(document).on("pageInit","#page-cart-address",
function(b,d,c){function a(a){$.get("/Cart/address_page",{p:a},function(a){a=template("tpl_address_item",{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}var e=!1;b=c.data("page_num");var f=100<b?100:b;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),
$.refreshScroller())},1E3))});c.find("li").click(function(){var a=$(this).data("id"),b=$(this).find(".item-inner").html();$.fn.cookie("trj_cart_address_id",a);$.fn.cookie("trj_cart_address",b);$(this).addClass("active").siblings().removeClass("active");goback(!0)})});$(document).on("pageInit","#page-cart-next",function(b,d,c){function a(){var a=$("#address_id").val();if(""==a)return $.alert("\u8bf7\u9009\u62e9\u6536\u8d27\u5730\u5740\uff01"),!1;var b={};$(".shop-list").each(function(c){var d=$(this).find("#express").data();
d.address_id=a;d.express_type=$(this).find(".item-after span").data("value");b[c]=d});$.post("/Cart/express_price_multi",{data:b},function(a){10==a.code?$.router.load("/Login"):1==a.code?($.each(a.data,function(a,b){a=$('[id="'+a+'"]');var c=parseFloat(a.find("#express").data("total_price"));a.find(".express_price").html(b.express_price);c+=b.express_price;a.find(".pay_price").html(c.toFixed(2))}),e()):$.alert("\u66f4\u65b0\u8fd0\u8d39\u5931\u8d25\uff01")})}function e(){var a=0,b=0;$(".shop-list").each(function(c){a+=
parseFloat($(this).find(".pay_price").html());b+=parseFloat($(this).find(".score").html())});$(".cart-footer .pay_price").html(a.toFixed(2));$(".cart-footer .total_score").html(b.toFixed(2))}b=$.fn.cookie("trj_cart_address_id");d=$.fn.cookie("trj_cart_address");b&&d&&($("#address_id").val(b),$(".select-address .item-inner").html(d),$.fn.cookie("trj_cart_address_id",null),$.fn.cookie("trj_cart_address",null),a());$(".btn-submit").click(function(){if(""==$("#address_id").val())$.alert("\u8bf7\u9009\u62e9\u6536\u8d27\u5730\u5740\uff01");
else{var a=getFormJson("#form-cart");$.post("/Cart/create_orders",a,function(a){10==a.code?$.router.load("/Login"):1==a.code?location.href="/Cart/orders_multi_view/o_no/"+a.data.o_no:$.alert("\u521b\u5efa\u8ba2\u5355\u5931\u8d25\uff01<br />"+a.msg)})}});$('li[id="express"]').click(function(){var b=$(this),c=$(this).find(".item-after span").data("value"),d=$(this).closest("ul").find(".express_list").html();$(".popup-express .list-block ul").html(d);$('.popup-express .list-block ul li[data-express_type="'+
c+'"] .item-media').html('<i class="iconfont icon-qidong text-success"></i>');$(".popup-express .list-block ul li").click(function(){var c=$(this).data("express_type"),d=$(this).find(".item-title").html();b.data("express_type",c);b.find(".item-after").html(d);b.closest(".list-block").find('input[name="express_type"]').val(c);""!=$("#address_id").val()&&a();$.closeModal()})});$('li[id="is_sale"]').click(function(){var a=$(this),b=a.closest(".list-block").find("#coupon_id").val(),c=a.closest(".list-block").data(),
d="";if(0<$(this).find(".coupon-data").size())var k=$.trim($(this).find(".coupon-data").html()),m=$.parseJSON(k),d=d+template("tpl_cart_coupon",{data:m,coupon_data:k,coupon_id:b});$(".popup-sale ul").html(d);$(".popup-sale .list-block ul li").click(function(){var b=$(this).data("price");$(this).toggleClass("selected");if($(this).hasClass("selected")){a.closest(".list-block").find("#coupon_id").val($(this).data("coupon_id"));a.closest("ul").find(".sale_price").html(b);a.closest("ul").find(".pay_price").html((c.pay_price-
b).toFixed(2));var d=0,f=0,g=a.closest("ul").find(".goods-item").size();a.closest("ul").find(".goods-item").each(function(a){var e=$(this).data(),h=parseInt(e.total_price/c.goods_price*b*100)/100;a==g-1&&b-f!=h&&(h=b-f);0>h&&(h=0);f+=h;d+=(e.total_price-h)*e.score_ratio*100});a.closest("ul").find(".score").html(d)}else a.closest(".list-block").find("#coupon_id").val(""),a.closest("ul").find(".sale_price").html(0),a.closest("ul").find(".pay_price").html(c.pay_price.toFixed(2)),a.closest(".list-block").find(".score").html(c.total_score);
e()})})});$(document).on("pageInit","#page-cart-orders-multi",function(b,d,c){function a(a){a={};a.o_no=$("#o_no").val();a.o_no&&$.post("/DtpayReturn/multi_orders_check",a,function(a){if(10==a.code)$.router.load("/Login");else if(1==a.code||2==a.code)clearInterval(f),$.closeModal("#popup-iframe-dtpay"),$("#page-iframe-dtpay").attr("src",""),$("h1").html("\u652f\u4ed8\u7ed3\u679c"),$(".bar-tab").remove(),a=template("tpl_orders_multi_pay_result2",{data:a}),$(".content").html(a)})}b=$("#use_payment_method").data("use_payment_method");
var e,f;$(".pay-type li").eq(0).addClass("selected");$(".pay-type li").click(function(){$(this).addClass("selected").siblings().removeClass("selected")});2==b?e=$("#use_dtpay").is(":checked"):0==b?e=!1:1==b&&(e=!0);$("#use_dtpay").change(function(){(e=$(this).is(":checked"))?($(".payment_method_content .payment_method_mall").find("li").removeClass("selected"),$(".payment_method_content .payment_method_erp").show().siblings("div").hide(),$(".payment_method_content .payment_method_erp").find("li").eq(0).addClass("selected").siblings().removeClass("selected")):
($(".payment_method_content .payment_method_erp").find("li").removeClass("selected"),$(".payment_method_content .payment_method_mall").show().siblings("div").hide(),$(".payment_method_content .payment_method_mall").find("li").eq(0).addClass("selected").siblings().removeClass("selected"))});$(".btn-submit").click(function(){if(e)$("#paytype").val($(".payment_method_erp li.selected").data("value")),clearInterval(f),f=setInterval(function(){a()},3E3),$(".pay_submit").click(),$.popup("#popup-iframe-dtpay");
else{var b={};b.o_no=$("#o_no").val();b.pay_password=$("#pay_password").val();b.paytype=$(".payment_method_mall li.selected").data("value");""==b.pay_password?$.toast("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801\uff01"):$.post("/Cart/orders_multi_pay",b,function(a){10==a.code?$.router.load("/Login"):0!=a.code?($("h1").html("\u652f\u4ed8\u7ed3\u679c"),$(".bar-tab").remove(),a=template("tpl_orders_multi_pay_result",{data:a.data}),$(".content").html(a)):$.alert(a.msg)})}})});$(document).on("pageInit",
"#page-cart-address-add",function(b,d,c){$(".btn-submit").click(function(){var a=getFormJson("#form-shopaddress-add");if(""==a.linkname)return $.toast("\u8bf7\u8f93\u5165\u8054\u7cfb\u4eba\uff01"),!1;if(""==a.mobile&&""==a.tel)return $.toast("\u624b\u673a\u53f7\u7801\u6216\u7535\u8bdd\u53f7\u7801\u4e24\u9879\u5fc5\u987b\u586b\u5199\u4e00\u9879\uff01"),!1;if(""==a.province||""==a.city||""==a.district)return $.toast("\u8bf7\u9009\u62e9\u57ce\u5e02\uff01"),!1;if(""==a.street)return $.toast("\u8bf7\u8f93\u5165\u8be6\u7ec6\u5730\u5740\uff01"),
!1;var b=c.find("form").attr("action");$.post(b,a,function(a){1==a.code?$.router.load("/Cart/address",!0):$.toast(a.msg)})});$(".popup-province .open-popup").click(function(){$(this).closest("li").addClass("active").siblings().removeClass("active");$(".popup-city ul").html("");$.get("/City/city_item/sid/"+$(this).data("id"),function(a){1==a.code?(a=template("tpl_city_item",{data:a.data}),$(".popup-city ul").html(a)):$.toast("\u8bfb\u53d6\u57ce\u5e02\u5217\u8868\u5931\u8d25\uff01")})})});$(document).on("pageInit",
"#page-orders-close",function(b,d,c){$(".btn-submit").click(function(){var a=getFormJson("#form-close-orders");if(""==a.reason)return $.toast("\u8bf7\u8f93\u5165\u5173\u95ed\u539f\u56e0\uff01"),!1;$.post("/Orders/close_save",a,function(a){1==a.code?goback(!0):$.toast(a.msg)})});$(".popup-province .open-popup").click(function(){$(this).closest("li").addClass("active").siblings().removeClass("active");$(".popup-city ul").html("");$.get("/City/city_item/sid/"+$(this).data("id"),function(a){1==a.code?
(a=template("tpl_city_item",{data:a.data}),$(".popup-city ul").html(a)):$.toast("\u8bfb\u53d6\u57ce\u5e02\u5217\u8868\u5931\u8d25\uff01")})})});$(document).on("pageInit","#page-orders-view",function(b,d,c){function a(a){a={};a.s_no=$("#orders-view-dtpay #s_no").val();""!=a.s_no&&$.post("/DtpayReturn/single_orders_check",a,function(a){10==a.code?(clearInterval(f),$.router.load("/Login")):1==a.code&&($.closeModal("#popup-iframe-dtpay"),$("#popup-iframe-dtpay").attr("src",""),$.alert("\u4ed8\u6b3e\u6210\u529f"),
clearInterval(f),window.location.reload())})}b=$("#use_payment_method").data("use_payment_method");var e,f;$(".pay-type li").eq(0).addClass("selected");$(".pay-type li").click(function(){$(this).addClass("selected").siblings().removeClass("selected")});2==b?e=$("#use_dtpay").is(":checked"):0==b?e=!1:1==b&&(e=!0);$("#use_dtpay").change(function(){(e=$(this).is(":checked"))?($(".payment_method_content .payment_method_mall").find("li").removeClass("selected"),$(".payment_method_content .payment_method_erp").show().siblings("div").hide(),
$(".payment_method_content .payment_method_erp").find("li").eq(0).addClass("selected").siblings().removeClass("selected")):($(".payment_method_content .payment_method_erp").find("li").removeClass("selected"),$(".payment_method_content .payment_method_mall").show().siblings("div").hide(),$(".payment_method_content .payment_method_mall").find("li").eq(0).addClass("selected").siblings().removeClass("selected"))});$(".btn-submit-pay").click(function(){if(e)$("#orders-view-dtpay #paytype").val($(".pay-type li.selected").data("value")),
clearInterval(f),f=setInterval(function(){a()},3E3),$("#orders-view-dtpay .pay_submit").click(),$.popup("#popup-iframe-dtpay");else{var b=getFormJson("#form-pay");b.paytype=$(".pay-type li.selected").data("value");""==b.pay_password?$.toast("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801\uff01"):""==b.s_no?$.toast("\u8ba2\u5355\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01"):$.post("/Orders/orders_pay",b,function(a){10==a.code?$.router.load("/Login"):1==a.code?($.alert(a.msg),window.location.reload()):$.alert(a.msg)})}});
$("#popup-iframe-dtpay .btn-close").click(function(){clearInterval(f);$.closeModal("#popup-iframe-dtpay");$("#popup-iframe-dtpay").attr("src","")});$(".btn-submit").click(function(){var a=getFormJson("#form-receive");""==a.pay_password?$.toast("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801\uff01"):""==a.s_no?$.toast("\u8ba2\u5355\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01"):$.post("/Orders/receive",a,function(a){10==a.code?$.router.load("/Login"):1==a.code?($.alert(a.msg),window.location.reload()):$.alert(a.msg)})})});
$(document).on("pageInit","#page-orders",function(b,d,c){function a(a){a={p:a};var b=$("#status").val();""!=b&&(a.status=b);$.get("/Orders/orders_page",a,function(a){a=template("tpl_orders",{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}function e(a){a={};a.s_no=$("#dtpay #s_no").val();""!=a.s_no&&$.post("/DtpayReturn/single_orders_check",a,function(a){10==a.code?(clearInterval(l),$.router.load("/Login")):1==a.code&&($.closeModal("#popup-iframe-dtpay"),$("#popup-iframe-dtpay").attr("src",
""),$.alert("\u4ed8\u6b3e\u6210\u529f"),clearInterval(l),window.location.reload())})}var f=!1,g=c.data("page_num");b=$("#use_payment_method").data("use_payment_method");var h,l;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($("#p").val());f||(f=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){f=!1;b>g?($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))});$('[data-popup=".popup-receive"]').click(function(){var a=
$(this).attr("data-s_no");$("#form-receive #s_no").val(a)});$('[data-popup=".popup-paytype"]').click(function(){var a=$(this).attr("data-s_no");$("#form-pay #s_no").val(a);$("#dtpay #s_no").val(a)});$(".pay-type li").eq(0).addClass("selected");$(".pay-type li").click(function(){$(this).addClass("selected").siblings().removeClass("selected")});2==b?h=$("#use_dtpay").is(":checked"):0==b?h=!1:1==b&&(h=!0);$("#use_dtpay").change(function(){(h=$(this).is(":checked"))?($(".payment_method_content .payment_method_mall").find("li").removeClass("selected"),
$(".payment_method_content .payment_method_erp").show().siblings("div").hide(),$(".payment_method_content .payment_method_erp").find("li").eq(0).addClass("selected").siblings().removeClass("selected")):($(".payment_method_content .payment_method_erp").find("li").removeClass("selected"),$(".payment_method_content .payment_method_mall").show().siblings("div").hide(),$(".payment_method_content .payment_method_mall").find("li").eq(0).addClass("selected").siblings().removeClass("selected"))});$(".btn-submit-pay").click(function(){if(h)$("#dtpay #paytype").val($(".pay-type li.selected").data("value")),
clearInterval(l),l=setInterval(function(){e()},3E3),$("#dtpay .pay_submit").click(),$.popup("#popup-iframe-dtpay");else{var a=getFormJson("#form-pay");a.paytype=$(".pay-type li.selected").data("value");""==a.pay_password?$.toast("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801\uff01"):""==a.s_no?$.toast("\u8ba2\u5355\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01"):$.post("/Orders/orders_pay",a,function(a){10==a.code?$.router.load("/Login"):1==a.code?($.alert(a.msg),window.location.reload()):$.alert(a.msg)})}});
$("#popup-iframe-dtpay .btn-close").click(function(){clearInterval(l);$.closeModal("#popup-iframe-dtpay");$("#popup-iframe-dtpay").attr("src","")});$(".btn-submit").click(function(){var a=getFormJson("#form-receive");""==a.pay_password?$.toast("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801\uff01"):""==a.s_no?$.toast("\u8ba2\u5355\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01"):$.post("/Orders/receive",a,function(a){10==a.code?$.router.load("/Login"):1==a.code?($.alert(a.msg),window.location.reload()):$.alert(a.msg)})})});
$(document).on("pageInit","#page-notice",function(b,d,c){function a(a,b){a={p:a};var c=$("#status").val();""!=c&&(a.status=c);$.get("/Notice/notice_page",a,function(a){1==a.code&&(a=template("tpl_notice_list",{data:a.data.list}),$(".infinite-scroll").eq(b).find(".list-container").append(a))})}var e=!1;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($(".infinite-scroll").eq(0).find("#p").val()),d=parseInt($(".infinite-scroll").eq(1).find("#p").val()),h=parseInt($(".infinite-scroll").eq(2).find("#p").val());
e||(e=!0,c.find(".infinite-scroll.active .infinite-scroll-preloader").show(),setTimeout(function(){e=!1;var f=0,g=c.find(".infinite-scroll.active").data("page_num"),m=b;"tab2"==c.find(".infinite-scroll.active").attr("id")?(f=1,m=d):"tab3"==c.find(".infinite-scroll.active").attr("id")&&(f=2,m=h);if(m>g)c.find(".infinite-scroll.active .infinite-scroll-preloader").hide();else{a(m,f);switch(f){case 1:d++;$(".infinite-scroll").eq(f).find("#p").val(d);break;case 2:h++;$(".infinite-scroll").eq(f).find("#p").val(h);
break;default:b++,$(".infinite-scroll").eq(f).find("#p").val(b)}$.refreshScroller()}},1E3))})});$(document).on("pageInit","#page-service",function(b,d,c){function a(a,b){a={p:a};1==b&&(a.status="1");$.get("/Service/service_page",a,function(a){a=template("tpl_service_list",{data:a.data.list});$(".infinite-scroll").eq(b).find(".list-container").append(a)})}var e=!1;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($(".infinite-scroll").eq(0).find("#p").val()),d=parseInt($(".infinite-scroll").eq(1).find("#p").val());
e||(e=!0,c.find(".infinite-scroll.active .infinite-scroll-preloader").show(),setTimeout(function(){e=!1;var f=0,g=c.find(".infinite-scroll.active").data("page_num"),k=b;"tab2"==c.find(".infinite-scroll.active").attr("id")&&(f=1,k=d);if(k>g)c.find(".infinite-scroll.active .infinite-scroll-preloader").hide();else{a(k,f);switch(f){case 1:d++;$(".infinite-scroll").eq(f).find("#p").val(d);break;default:b++,$(".infinite-scroll").eq(f).find("#p").val(b)}$.refreshScroller()}},1E3))})});$(document).on("pageInit",
"#page-service-view",function(b,d,c){$(".btn-cancel").click(function(){var a=$(this).attr("data-r_no"),b=$(this).attr("data-s_no");$.confirm("\u786e\u5b9a\u53d6\u6d88\u552e\u540e\u7533\u8bf7\u5417?",function(){$.post("/Service/cancel",{r_no:a,s_no:b},function(a){1==a.code?($.toast(a.msg),window.location.reload()):$.toast("\u64cd\u4f5c\u5931\u8d25\uff01")})})})});$(document).on("pageInit","#page-service-send-express",function(b,d,c){$(".btn-submit").click(function(){if(""==$("#express_company_id").val())$.alert("\u8bf7\u9009\u62e9\u5feb\u9012\u516c\u53f8\uff01");
else if(""==$("#express_code").val())$.alert("\u8bf7\u586b\u5199\u5feb\u9012\u5355\u53f7\uff01");else{var a=getFormJson("#form-express-goods");$.post("/Service/send_express",a,function(b){$.toast(b.msg);1==b.code&&$.router.load("/Service/view/r_no/"+a.r_no,!0)})}});$(".popup-company li").click(function(){var a=$(this).data("id");$("#express_company_id").val(a);$(".select-company").html($(this).find(".item-content").html());$.closeModal(".popup-company")})});$(document).on("pageInit","#page-service-select-address",
function(b,d,c){function a(a){$.get("/Service/select_address_page",{p:a+1},function(a){a=template("tpl_address_item",{data:a.data.list});$(".infinite-scroll .list-container").append(a)})}var e=!1,f=1;b=c.data("page_num");var g=100<b?100:b;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;f>g?($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").hide()):(a(f),f++,$.refreshScroller())},
1E3))});c.find("li").click(function(){var a=$(this).data("id"),b=$(this).find(".item-inner").html();$.fn.cookie("trj_service_address_id",a);$.fn.cookie("trj_service_address",b);$(this).addClass("active").siblings().removeClass("active");$.router.back()})});$(document).on("pageInit","#page-service-appeal",function(b,d,c){$("#imageData").each(function(){var a=$(this);a.localResizeIMG({width:600,quality:1,success:function(b){5<=a.closest(".upload-box").find(".images-list img").size()?$.toast("\u6652\u56fe\u6700\u591a\u53ea\u80fd\u4f205\u5f20\uff01"):
$.post("/Upload/upload",{base64_string:b.clearBase64},function(b){if(1==b.code)if(0<a.closest(".upload-box").find('img[data-images="'+b.data.url+'"]').size())$.toast("\u8be5\u56fe\u7247\u5df2\u4e0a\u4f20\u8fc7\uff01");else{b='<img src="'+b.data.url+'" alt="\u6652\u56fe" data-images="'+b.data.url+'" onclick="rate_images_remove($(this))">';a.closest(".upload-box").find(".images-list").append(b);var c=[];a.closest(".upload-box").find(".images-list img").each(function(a){c[a]=$(this).data("images")});
a.closest(".upload-box").find("#images").val(c.join(","))}})}})});$(".btn-submit").click(function(){if(""==$("#remark").val())$.alert("\u8bf7\u586b\u5199\u7533\u8bc9\u7406\u7531\uff01");else{var a=getFormJson("#form-appeal");""==a.num?$.alert("\u8bf7\u586b\u5199\u7533\u8bc9\u5546\u54c1\u6570\u91cf\uff01"):0>=a.num?$.alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u552e\u540e\u6570\u91cf\uff01"):$.post("/Service/appeal",a,function(a){$.toast(a.msg);1==a.code&&goback(!0)})}})});$(document).on("pageInit",
"#page-service-edit",function(b,d,c){$("#imageData").each(function(){var a=$(this);a.localResizeIMG({width:600,quality:1,success:function(b){5<=a.closest(".upload-box").find(".images-list img").size()?$.toast("\u6652\u56fe\u6700\u591a\u53ea\u80fd\u4f205\u5f20\uff01"):$.post("/Upload/upload",{base64_string:b.clearBase64},function(b){if(1==b.code)if(0<a.closest(".upload-box").find('img[data-images="'+b.data.url+'"]').size())$.toast("\u8be5\u56fe\u7247\u5df2\u4e0a\u4f20\u8fc7\uff01");else{b='<img src="'+
b.data.url+'" alt="\u6652\u56fe" data-images="'+b.data.url+'" onclick="rate_images_remove($(this))">';a.closest(".upload-box").find(".images-list").append(b);var c=[];a.closest(".upload-box").find(".images-list img").each(function(a){c[a]=$(this).data("images")});a.closest(".upload-box").find("#images").val(c.join(","))}})}})});$(".btn-submit").click(function(){var a=$("#num").val();""==a?$.alert("\u8bf7\u8f93\u5165\u7533\u8bf7\u6570\u91cf\uff01"):0>=a?$.alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u552e\u540e\u6570\u91cf\uff01"):
""==$("#reason").val()?$.alert("\u8bf7\u586b\u5199\u7533\u8bc9\u539f\u56e0\uff01"):(a=getFormJson("#form-edit"),$.post("/Service/edit",a,function(a){$.toast(a.msg);1==a.code&&$.router.back()}))})});$(document).on("pageInit","#page-service-add",function(b,d,c){$("#imageData").each(function(){var a=$(this);a.localResizeIMG({width:600,quality:1,success:function(b){5<=a.closest(".upload-box").find(".images-list img").size()?$.toast("\u6652\u56fe\u6700\u591a\u53ea\u80fd\u4f205\u5f20\uff01"):$.post("/Upload/upload",
{base64_string:b.clearBase64},function(b){if(1==b.code)if(0<a.closest(".upload-box").find('img[data-images="'+b.data.url+'"]').size())$.toast("\u8be5\u56fe\u7247\u5df2\u4e0a\u4f20\u8fc7\uff01");else{b='<img src="'+b.data.url+'" alt="\u6652\u56fe" data-images="'+b.data.url+'" onclick="rate_images_remove($(this))">';a.closest(".upload-box").find(".images-list").append(b);var c=[];a.closest(".upload-box").find(".images-list img").each(function(a){c[a]=$(this).data("images")});a.closest(".upload-box").find("#images").val(c.join(","))}})}})});
$(".btn-submit").click(function(){var a=getFormJson("#form-add");""==a.num?$.alert("\u8bf7\u586b\u5199\u552e\u540e\u6570\u91cf\uff01"):0>=a.num?$.alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u552e\u540e\u6570\u91cf\uff01"):""==a.reason?$.alert("\u8bf7\u586b\u5199\u7533\u8bf7\u552e\u540e\u7406\u7531\uff01"):$.post("/Service/service_add",a,function(a){$.toast(a.msg);1==a.code&&goback(!0)})})});$(document).on("pageInit","#page-orders-service-logs",function(b,d,c){$(".show-form").click(function(){$("form").toggleClass("hide");
$(this).addClass("hide")});$("#imageData").each(function(){var a=$(this);a.localResizeIMG({width:600,quality:1,success:function(b){5<=a.closest(".upload-box").find(".images-list img").size()?$.toast("\u6652\u56fe\u6700\u591a\u53ea\u80fd\u4f205\u5f20\uff01"):$.post("/Upload/upload",{base64_string:b.clearBase64},function(b){if(1==b.code)if(0<a.closest(".upload-box").find('img[data-images="'+b.data.url+'"]').size())$.toast("\u8be5\u56fe\u7247\u5df2\u4e0a\u4f20\u8fc7\uff01");else{b='<img src="'+b.data.url+
'" alt="\u6652\u56fe" data-images="'+b.data.url+'" onclick="rate_images_remove($(this))">';a.closest(".upload-box").find(".images-list").append(b);var c=[];a.closest(".upload-box").find(".images-list img").each(function(a){c[a]=$(this).data("images")});a.closest(".upload-box").find("#images").val(c.join(","))}})}})});$(".btn-submit").click(function(){var a=getFormJson("#form-logs-add");if(""==a.remark)return $.toast("\u8bf7\u586b\u5199\u7559\u8a00\u6216\u5907\u6ce8\uff01"),!1;$.post("/Service/logs_add",
a,function(a){10==a.code?$.router.load("/Login"):1==a.code?window.location.reload():$.alert(a.msg)})})});$(document).on("pageInit","#page-orders-rate",function(b,d,c){$("#imageData").each(function(){var a=$(this);a.localResizeIMG({width:600,quality:1,success:function(b){5<=a.closest(".upload-box").find(".images-list img").size()?$.toast("\u6652\u56fe\u6700\u591a\u53ea\u80fd\u4f205\u5f20\uff01"):$.post("/Upload/upload",{base64_string:b.clearBase64},function(b){if(1==b.code)if(0<a.closest(".upload-box").find('img[data-images="'+
b.data.url+'"]').size())$.toast("\u8be5\u56fe\u7247\u5df2\u4e0a\u4f20\u8fc7\uff01");else{b='<img src="'+b.data.url+'" alt="\u6652\u56fe" data-images="'+b.data.url+'" onclick="rate_images_remove($(this))">';a.closest(".upload-box").find(".images-list").append(b);var c=[];a.closest(".upload-box").find(".images-list img").each(function(a){c[a]=$(this).data("images")});a.closest(".upload-box").find("#images").val(c.join(","))}})}})});$(".btn-submit").click(function(){var a=getFormJson("#form-rate");$.post("/Orders/rate_save",
a,function(a){10==a.code?$.router.load("/Login"):1==a.code?goback(!0):$.alert(a.msg)})})});$(document).on("pageInit","#page-refund",function(b,d,c){function a(a,b){a={p:a};1==b&&(a.status=1);$.get("/Refund/refund_page",a,function(a){a=template("tpl_refund_list",{data:a.data.list});$(".infinite-scroll").eq(b).find(".list-container").append(a)})}var e=!1;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($(".infinite-scroll").eq(0).find("#p").val()),d=parseInt($(".infinite-scroll").eq(1).find("#p").val());
e||(e=!0,c.find(".infinite-scroll.active .infinite-scroll-preloader").show(),setTimeout(function(){e=!1;var f=0,g=c.find(".infinite-scroll.active").data("page_num"),k=b;"tab2"==c.find(".infinite-scroll.active").attr("id")&&(f=1,k=d);if(k>g)c.find(".infinite-scroll.active .infinite-scroll-preloader").hide();else{a(k,f);switch(f){case 1:d++;$(".infinite-scroll").eq(f).find("#p").val(d);break;default:b++,$(".infinite-scroll").eq(f).find("#p").val(b)}$.refreshScroller()}},1E3))})});$(document).on("pageInit",
"#page-orders-refund-goods",function(b,d,c){$(".btn-submit").click(function(){var a=getFormJson("#form-refund-goods"),b=$("#num").data("max");if(""==a.num)return $.toast("\u8bf7\u8f93\u5165\u9000\u56de\u6570\u91cf\uff01"),!1;if(0>a.num||a.num>b)return $.toast("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6570\u91cf\uff0c\u6700\u591a\u53ef\u9000"+b+"\u4ef6\uff01"),!1;if(0<$("#express_price").size()&&(b=$("#express_price").data("max"),0>a.express_price||a.express_price>b))return $.toast("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8fd0\u8d39\u91d1\u989d\uff0c\u6700\u591a\u53ef\u9000\uffe5"+
b+"\uff01"),!1;if(""==a.reason)return $.toast("\u8bf7\u586b\u5199\u9000\u6b3e\u539f\u56e0\uff01"),!1;$.post("/Refund/add",a,function(a){10==a.code?$.router.load("/Login"):1==a.code?$.router.load("/Refund/view/r_no/"+a.data.r_no,!0):$.alert(a.msg)})})});$(document).on("pageInit","#page-refund-view",function(b,d,c){$(".refund-cancel").click(function(){var a=$(this).attr("data-r_no");$.confirm("\u786e\u5b9a\u8981\u53d6\u6d88\u9000\u6b3e\u5417\uff1f",function(){$.post("/Refund/cancel",{r_no:a},function(a){10==
a.code?$.router.load("/Login"):1==a.code?window.location.reload():$.alert(a.msg)})})});$(".refund-cancel2").click(function(){var a=$(this).attr("data-r_no");$.confirm("\u786e\u5b9a\u8981\u53d6\u6d88\u9000\u6b3e\u5417\uff1f",function(){$.post("/Refund2/cancel",{r_no:a},function(a){10==a.code?$.router.load("/Login"):1==a.code?window.location.reload():$.alert(a.msg)})})})});$(document).on("pageInit","#page-refund2-goods,#page-refund2-edit",function(b,d,c){$("#imageData").each(function(){var a=$(this);
a.localResizeIMG({width:600,quality:1,success:function(b){5<=a.closest(".upload-box").find(".images-list img").size()?$.toast("\u6652\u56fe\u6700\u591a\u53ea\u80fd\u4f205\u5f20\uff01"):$.post("/Upload/upload",{base64_string:b.clearBase64},function(b){if(1==b.code)if(0<a.closest(".upload-box").find('img[data-images="'+b.data.url+'"]').size())$.toast("\u8be5\u56fe\u7247\u5df2\u4e0a\u4f20\u8fc7\uff01");else{b='<img src="'+b.data.url+'" alt="\u6652\u56fe" data-images="'+b.data.url+'" onclick="rate_images_remove($(this))">';
a.closest(".upload-box").find(".images-list").append(b);var c=[];a.closest(".upload-box").find(".images-list img").each(function(a){c[a]=$(this).data("images")});a.closest(".upload-box").find("#images").val(c.join(","))}})}})});$(".refund-type li").click(function(){$(this).addClass("selected").siblings().removeClass("selected");$('[data-popup=".popup-refundtype"] .item-after').html($(this).find(".item-title").html());var a=$(this).data("value");$("#type").val(a);1==a?$("#li-num").removeClass("hide"):
($("#li-num").addClass("hide"),$("#num").val(""))});$(".btn-submit").click(function(){var a=getFormJson("#form-refund-goods"),b=$("#num").data("max"),c=$("#price").data("max");if(0<$("#express_price").size())var d=$("#express_price").data("max");a.num||(a.num=0);a.price||(a.price=0);a.express_price||(a.express_price=0);if(1==a.type){if(1>a.num||a.num>b)return $.toast("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6570\u91cf\uff0c\u6700\u591a\u53ef\u9000"+b+"\u4ef6\uff01"),!1;if(0==a.price)return $.toast("\u8bf7\u586b\u5199\u9000\u6b3e\u91d1\u989d\uff01"),
!1}else if(a.num=0,0==a.price&&0==a.express_price)return $.toast("\u9000\u6b3e\u91d1\u989d\u6216\u9000\u8fd0\u8d39\u5fc5\u987b\u586b\u5199\u4e00\u9879\uff01"),!1;if(0>a.price||a.price>c)return $.toast("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u9000\u6b3e\u91d1\u989d\uff0c\u6700\u591a\u53ef\u9000"+c+"\u5143\uff01"),!1;if(0>a.express_price||a.express_price>d)return $.toast("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u9000\u8fd0\u8d39\u91d1\u989d\uff0c\u6700\u591a\u53ef\u9000"+d+"\u5143\uff01"),!1;if(""==a.reason)return $.toast("\u8bf7\u586b\u5199\u9000\u6b3e\u539f\u56e0\uff01"),
!1;b=$("#form-refund-goods").data("url");$.post(b,a,function(a){10==a.code?$.router.load("/Login"):1==a.code?$.router.load("/Refund/view/r_no/"+a.data.r_no,!0):$.alert(a.msg)})})});$(document).on("pageInit","#page-orders-refund-logs",function(b,d,c){$(".show-form").click(function(){$("form").toggleClass("hide");$(this).addClass("hide")});$("#imageData").each(function(){var a=$(this);a.localResizeIMG({width:600,quality:1,success:function(b){5<=a.closest(".upload-box").find(".images-list img").size()?
$.toast("\u6652\u56fe\u6700\u591a\u53ea\u80fd\u4f205\u5f20\uff01"):$.post("/Upload/upload",{base64_string:b.clearBase64},function(b){if(1==b.code)if(0<a.closest(".upload-box").find('img[data-images="'+b.data.url+'"]').size())$.toast("\u8be5\u56fe\u7247\u5df2\u4e0a\u4f20\u8fc7\uff01");else{b='<img src="'+b.data.url+'" alt="\u6652\u56fe" data-images="'+b.data.url+'" onclick="rate_images_remove($(this))">';a.closest(".upload-box").find(".images-list").append(b);var c=[];a.closest(".upload-box").find(".images-list img").each(function(a){c[a]=
$(this).data("images")});a.closest(".upload-box").find("#images").val(c.join(","))}})}})});$(".btn-submit").click(function(){var a=getFormJson("#form-logs-add");if(""==a.remark)return $.toast("\u8bf7\u586b\u5199\u7559\u8a00\u6216\u5907\u6ce8\uff01"),!1;$.post("/Refund/logs_add",a,function(a){10==a.code?$.router.load("/Login"):1==a.code?window.location.reload():$.alert(a.msg)})})});$(document).on("pageInit","#page-refund-express-goods",function(b,d,c){$(".popup-company li").click(function(){var a=
$(this).data("id");$("#express_company_id").val(a);$(".select-company").html($(this).find(".item-content").html());$.closeModal(".popup-company")});$(".btn-submit").click(function(){var a=getFormJson("#form-express-goods");""==a.express_company_id?$.toast("\u8bf7\u9009\u62e9\u5feb\u9012\u516c\u53f8\uff01"):""==a.express_code?$.toast("\u8bf7\u8f93\u5165\u5feb\u9012\u8fd0\u5355\u53f7\uff01"):$.post("/Refund2/send_express",a,function(a){10==a.code?$.router.load("/Login"):1==a.code?goback(!0):$.alert(a.msg)})})});
$(document).on("pageInit","#page-refund2-appeal",function(b,d,c){$("#imageData").each(function(){var a=$(this);a.localResizeIMG({width:600,quality:1,success:function(b){5<=a.closest(".upload-box").find(".images-list img").size()?$.toast("\u6652\u56fe\u6700\u591a\u53ea\u80fd\u4f205\u5f20\uff01"):$.post("/Upload/upload",{base64_string:b.clearBase64},function(b){if(1==b.code)if(0<a.closest(".upload-box").find('img[data-images="'+b.data.url+'"]').size())$.toast("\u8be5\u56fe\u7247\u5df2\u4e0a\u4f20\u8fc7\uff01");
else{b='<img src="'+b.data.url+'" alt="\u6652\u56fe" data-images="'+b.data.url+'" onclick="rate_images_remove($(this))">';a.closest(".upload-box").find(".images-list").append(b);var c=[];a.closest(".upload-box").find(".images-list img").each(function(a){c[a]=$(this).data("images")});a.closest(".upload-box").find("#images").val(c.join(","))}})}})});$(".btn-submit").click(function(){var a=getFormJson("#form-refund-appeal");if(""==a.remark)return $.toast("\u8bf7\u586b\u5199\u7533\u8bc9\u539f\u56e0\uff01"),
!1;var b=$("#form-refund-appeal").data("url");$.post(b,a,function(a){10==a.code?$.router.load("/Login"):1==a.code?goback(!0):$.alert(a.msg)})})});$(document).on("pageInit","#Message-index",function(b,d,c){$(".message-store").on("click",function(){$.router.load("/Notice")});$(".message-seller").on("click",function(){$.router.load("/SellerMessage/",!0)})});$(document).on("pageInit","#Seller-Message-index",function(b,d,c){$(".item-content").on("click",function(){$.router.load("/SellerMessage/info/shop_id/"+
$(this).data("shopid")+"/receiver/"+$(this).data("username"))})});$(document).on("pageInit","#Seller-Message-info",function(b,d,c){$(".into-shop").on("click",function(){$.router.load("/Shop/index/shop_id/"+$(this).data("shopid"))})});$(document).on("pageInit","#page-my-coupon",function(b,d,c){function a(a,b){a={p:a};1==b?a.is_expire=1:a.is_use=1;$.get("/Coupon/my_coupon_page",a,function(a){a=template("tpl_my_coupon",{data:a.data.list});$(".infinite-scroll").eq(b).find(".list-container ul").append(a)})}
var e=!1;$(".infinite-scroll-preloader").hide();$(c).on("infinite",function(){var b=parseInt($(".infinite-scroll").eq(0).find("#p").val()),d=parseInt($(".infinite-scroll").eq(1).find("#p").val());e||(e=!0,c.find(".infinite-scroll.active .infinite-scroll-preloader").show(),setTimeout(function(){e=!1;var f=0,g=c.find(".infinite-scroll.active").data("page_num"),k=b;"tab2"==c.find(".infinite-scroll.active").attr("id")&&(f=1,k=d);if(k>g)c.find(".infinite-scroll.active .infinite-scroll-preloader").hide();
else{a(k,f);switch(f){case 1:d++;$(".infinite-scroll").eq(f).find("#p").val(d);break;default:b++,$(".infinite-scroll").eq(f).find("#p").val(b)}$.refreshScroller()}},1E3))})});$(document).on("pageInit","#sellergoods-index",function(b,d,c){function a(a){a={p:a};var b=$("#status").val();""!=b&&(a.status=b);$.get("/SellerGoods/goods_page",a,function(a){a=template("tpl_seller_goods",{data:a.data.list});$(".infinite-scroll .media-list ul").append(a)})}var e=!1,f=c.data("page_num");$(".infinite-scroll-preloader").hide();
$(c).on("infinite",function(){var b=parseInt($("#p").val());e||(e=!0,$(".infinite-scroll-preloader").show(),setTimeout(function(){e=!1;b>f?($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").hide()):(a(b),b++,$("#p").val(b),$.refreshScroller())},1E3))})});$.init()});