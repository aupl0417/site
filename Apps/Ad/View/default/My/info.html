<css href="__PUBLIC__/Jquery/DateTimePicker/jquery.datetimepicker.css" />
<div class="container fs14">
	<div class="mt40"><strong><a href="javascript:;" onclick="back()">我的广告</a> > 广告详情</strong></div>
	<div class="mt10 bor_der bg-white">
		<div class="fs14 p10">
			<div class="fl"><strong>订单信息</strong></div>
			<div class="fr">
				<switch name="data['status']">
					<case value="0">
						<strong><i class="layui-icon" style="color: red;vertical-align: middle;font-size: 24px;">&#xe60b;</i></strong>
						<strong>状态：未付款</strong>
					</case>
					<case value="1">
						<strong><i class="layui-icon" style="color: green;vertical-align: middle;font-size: 24px;">&#x1005;</i></strong>
						<strong>状态：已付款</strong>
					</case>
					<case value="2">
						<strong><i class="layui-icon" style="color: red;vertical-align: middle;font-size: 24px;">&#xe60b;</i></strong>
						<strong>状态：强制下架</strong>
					</case>
					<case value="3">
						<strong><i class="layui-icon" style="color: green;vertical-align: middle;font-size: 24px;">&#x1005;</i></strong>
						<strong>状态：投放中</strong>
					</case>
					<case value="4">
						<strong><i class="layui-icon" style="color: red;vertical-align: middle;font-size: 24px;">&#xe60b;</i></strong>
						<strong>状态：待投放</strong>
					</case>
					<case value="5">
						<strong><i class="layui-icon" style="color: red;vertical-align: middle;font-size: 24px;">&#xe60b;</i></strong>
						<strong>状态：已过期</strong>
					</case>
				</switch>
			</div>
			<div class="clearfix"></div>
			<div class="row mt30 p10">
				<div class="col-xs-6">
					<div class="mb15">投放素材：<a href="{$data.images}" class="image-zoom"><img src="{:myurl($data['images'],['w' => 150,'h' => 85])}" class="bor_der" style="vertical-align: text-top"/></a></div>
					<div class="mb15">投放天数：<strong>{$data.num}</strong> 天</div>
					<div>创建时间：{$data.atime}</div>
				</div>
				<div class="col-xs-6">
					<div class="mb25">订单编号：{$data.a_no}</div>
					<div class="mb25">投放类型：{$data.type_name}</div>
					<div class="mb25">投放位置：位置{$data['sort']+1}</div>
					<div class="">投放日期：{$data.sday} 到 {$data.eday}</div>
				</div>
			</div>
			<hr/>
			<div class="fs14 p10">
				<strong>广告信息</strong>
			</div>
			<div class="row mt30 p10">
				<div class="col-xs-6">
					<div class="mb30">位&#12288;&#12288;置：<a href="{$position.images}" class="image-zoom"><img src="{:myurl($position['images'],['w' => 150,'h' => 85])}" class="bor_der" style="vertical-align: text-top"/></a></div>
					<div class="">价&#12288;&#12288;格：<strong>{$data.price}元/日</strong></div>
				</div>
				<div class="col-xs-6">
					<div class="mb20">名&#12288;&#12288;称：{$data.name}</div>
					<div class="mb20">尺&#12288;&#12288;寸：{$position.width}x{$position.height} （px）</div>
					<div class="mb20">平&#12288;&#12288;台：
						<switch name="position.device">
	                        <case value="1">PC端</case>
	                        <case value="2">移动端</case>
	                        <default />未知
	                    </switch>
	                </div>
					<div class="">类&#12288;&#12288;型：
						<switch name="position.type">
	                        <case value="1">图片</case>
	                        <case value="2">焦点图</case>
	                        <case value="3">文本</case>
	                        <default />未知
	                    </switch>
					</div>
				</div>
			</div>
			<hr/>
			<div class="fs14 p10">
				<strong>投放效果</strong>
			</div>
			<div class="fs14 p10">
				<strong>统计数据</strong><span class="text-gray ml10 fs12">截止到昨日的统计数据</span>
			</div>
			<div class="p10">
				<table class="layui-table bg-white bor_der" lay-skin="nob">
					<tr>
						<th class="text-center text-gray h60" style="border: 0;font-size: 16px;">展示量</th>
						<th class="text-center text-gray" style="border: 0;font-size: 16px;">点击量</th>
						<th class="text-center text-gray" style="border: 0;font-size: 16px;">点击量（%）</th>
						<th class="text-center text-gray" style="border: 0;font-size: 16px;">成交笔数</th>
						<th class="text-center text-gray" style="border: 0;font-size: 16px;">成交金额（元）</th>
						<th class="text-center text-gray" style="border: 0;font-size: 16px;">转化率（%）</th>
					</tr>
					<tr>
						<td class="text-center h60" style="border: 0;font-size: 16px;">{$tjdata.show}</td>
						<td class="text-center" style="border: 0;font-size: 16px;">{$tjdata.hit}</td>
						<td class="text-center" style="border: 0;font-size: 16px;">
							<php>echo round($tjdata['hit']/$tjdata['show']*100,2);</php>%
						</td>
						<td class="text-center" style="border: 0;font-size: 16px;">{$tjdata.orders}</td>
						<td class="text-center" style="border: 0;font-size: 16px;">{$tjdata.orders_price}</td>
						<td class="text-center" style="border: 0;font-size: 16px;">
							<php>echo round($tjdata['orders']/$tjdata['hit']*100,2);</php>%
						</td>
					</tr>
				</table>
				<div class="p20">
					<div id="Tjday" class="bg_white text-center" style="width: 100%; height: 400px;">
						<empty name="adstj">
							<br/>
	                		<span class="text_red">暂无数据</span>
	                	</empty>
					</div>
					<script src="/Public/new_design/js/amcharts.js" type="text/javascript"></script>
	    			<script src="/Public/new_design/js/serial.js" type="text/javascript"></script>
					<notempty name="adstj">
					<script>
						var chart;
						var chartData = [];
	
						AmCharts.ready(function () {
							// generate some random data first
							// generateChartData();
	
							// SERIAL CHART
							chart = new AmCharts.AmSerialChart();
	
							chart.dataProvider = eval({:json_encode($adstj)});
							// chart.dataProvider = chartData;
							// console.log(chart.dataProvider);
							chart.categoryField = "date";
	
							// listen for "dataUpdated" event (fired when chart is inited) and call zoomChart method when it happens
							// chart.addListener("dataUpdated", zoomChart);
	
							chart.synchronizeGrid = true; // this makes all axes grid to be at the same intervals
	
							// AXES
							// category
							var categoryAxis = chart.categoryAxis;
							// categoryAxis.parseDates = true; // as our data is date-based, we set parseDates to true
							categoryAxis.minPeriod = "DD"; // our data is daily, so we set minPeriod to DD
							// categoryAxis.minorGridEnabled = true;
							categoryAxis.axisColor = "#DADADA";
							categoryAxis.twoLineMode = true;
							categoryAxis.dateFormats = [{
								period: 'fff',
								format: 'JJ:NN:SS'
							}, {
								period: 'ss',
								format: 'JJ:NN:SS'
							}, {
								period: 'mm',
								format: 'JJ:NN'
							}, {
								period: 'hh',
								format: 'JJ:NN'
							}, {
								period: 'DD',
								format: 'DD'
							}, {
								period: 'WW',
								format: 'DD'
							}, {
								period: 'MM',
								format: 'MMM'
							}, {
								period: 'YYYY',
								format: 'YYYY'
							}];
	
							// first value axis (on the left)
							var valueAxis1 = new AmCharts.ValueAxis();
							valueAxis1.axisColor = "#FF6600";
							valueAxis1.axisThickness = 2;
							valueAxis1.offset = 50;
							valueAxis1.position = "left";
							chart.addValueAxis(valueAxis1);
	
							// second value axis (on the right)
							var valueAxis2 = new AmCharts.ValueAxis();
							valueAxis2.axisColor = "#FCD202";
							valueAxis2.gridAlpha = 0;
							valueAxis2.axisThickness = 2;
							valueAxis2.offset = 0;
							valueAxis2.position = "left";
							chart.addValueAxis(valueAxis2);
	
							// third value axis (on the left, detached)
							var valueAxis3 = new AmCharts.ValueAxis();
							valueAxis3.offset = 0; // this line makes the axis to appear detached from plot area
							valueAxis3.gridAlpha = 0;
							valueAxis3.axisColor = "#B0DE09";
							valueAxis3.axisThickness = 2;
							valueAxis3.position = "right";
							chart.addValueAxis(valueAxis3);
							
							var valueAxis4 = new AmCharts.ValueAxis();
							valueAxis4.offset = 50; // this line makes the axis to appear detached from plot area
							valueAxis4.gridAlpha = 0;
							valueAxis4.axisColor = "#2EA9DF";
							valueAxis4.axisThickness = 2;
							valueAxis4.position = "right"; // this line makes the axis to appear on the right
							chart.addValueAxis(valueAxis4);
	
							// GRAPHS
							// first graph
							var graph1 = new AmCharts.AmGraph();
							graph1.valueAxis = valueAxis1; // we have to indicate which value axis should be used
							graph1.title = "展现量";
							graph1.valueField = "show";
							graph1.bullet = "round";
							graph1.hideBulletsCount = 30;
							graph1.bulletBorderThickness = 1;
							chart.addGraph(graph1);
	
							// second graph
							var graph2 = new AmCharts.AmGraph();
							graph2.valueAxis = valueAxis2; // we have to indicate which value axis should be used
							graph2.title = "点击量";
							graph2.valueField = "hit";
							graph2.bullet = "square";
							graph2.hideBulletsCount = 30;
							graph2.bulletBorderThickness = 1;
							chart.addGraph(graph2);
	
							// third graph
							var graph3 = new AmCharts.AmGraph();
							graph3.valueAxis = valueAxis3; // we have to indicate which value axis should be used
							graph3.valueField = "orders";
							graph3.title = "成交笔数";
							graph3.bullet = "triangleUp";
							graph3.hideBulletsCount = 30;
							graph3.bulletBorderThickness = 1;
							chart.addGraph(graph3);
							
							var graph4 = new AmCharts.AmGraph();
							graph4.valueAxis = valueAxis4; // we have to indicate which value axis should be used
							graph4.valueField = "orders_price";
							graph4.title = "成交金额";
							graph4.bullet = "triangleDown";
							graph4.hideBulletsCount = 30;
							graph4.bulletBorderThickness = 1;
							chart.addGraph(graph4);
	
							// CURSOR
							var chartCursor = new AmCharts.ChartCursor();
							chartCursor.cursorAlpha = 0.1;
							chartCursor.fullWidth = true;
							chartCursor.valueLineBalloonEnabled = true;
							chart.addChartCursor(chartCursor);
	
							// SCROLLBAR
						   // var chartScrollbar = new AmCharts.ChartScrollbar();
							// chart.addChartScrollbar(chartScrollbar);
	
							// LEGEND
							var legend = new AmCharts.AmLegend();
							// legend.marginLeft = 110;
							legend.useGraphSettings = true;
							chart.addLegend(legend);
	
							// WRITE
							chart.write("Tjday");
						});
	
						// this method is called when chart is first inited as we listen for "dataUpdated" event
						function zoomChart() {
							// different zoom methods can be used - zoomToIndexes, zoomToDates, zoomToCategoryValues
							chart.zoomToIndexes(10, 20);
						}
					</script>
				</notempty>
				</div>
				<div class="fs14 p20">
					<strong>访问路径</strong><span class="text-gray ml10 fs12">访客从广告页进入后的访问路径</span>
				</div>
				<div class="fr">
					<div class="layui-inline">
						<label class="layui-form-label fs14 w100">查看日期：</label>
						<div class="layui-input-inline">
							<input type="text" id="date" value="" autocomplete="off" class="layui-input datepicker">
						</div>
				  	</div>
				  	<div class="layui-inline">
						<label class="layui-form-label w100 fs14">查看终端：</label>
						<div class="layui-input-inline">
							<button class="layui-btn layui-btn-warm btnc" onclick="setDvice('0',this)">全部</button>
							<button class="layui-btn layui-btn-primary btnc" onclick="setDvice('pc',this)">PC</button>
							<button class="layui-btn layui-btn-primary btnc" onclick="setDvice('wap',this)">移动端</button>
						</div>
				  	</div>
				  	<div class="layui-inline">
				  		<label class="layui-form-label w100 fs14">&nbsp;</label>
						<div class="layui-input-inline">
							<button class="layui-btn layui-btn-primary" onclick="page(1)">开始查询</button>
						</div>
				  	</div>
				</div>
				<div class="clearfix"></div>
				<div class="mt20">
					<table class="layui-table bg-white bor_der">
						<thead>
							<tr>
								<th class="text-center text-gray h60" style="border: 0;font-size: 16px;">访问用户</th>
								<th class="text-center text-gray" style="border: 0;font-size: 16px;">访问IP</th>
								<th class="text-center text-gray" style="border: 0;font-size: 16px;">访问时间</th>
								<th class="text-center text-gray" style="border: 0;font-size: 16px;">&nbsp;</th>
							</tr>
						</thead>
						<tbody id="content">
						</tbody>
					</table>
					<script id="fwlj" type="text/html">
						{{each list as value i}}
							<tr>
								<td class="text-center h60" style="border: 0;font-size: 16px;">{{value.nick}}</td>
								<td class="text-center" style="border: 0;font-size: 16px;">{{value.province}} {{value.city}}<br/>{{value.ip}}</td>
								<td class="text-center" style="border: 0;font-size: 16px;">{{value.time}}</td>
								<td class="text-center" style="border: 0;font-size: 16px;">
									<a href="javascript:;" class="" onclick="showDi({{i}})" style="color:dodgerblue">访问路径&nbsp;<i class="layui-icon" id="ico{{i}}">&#xe619;</i></a>
								</td>
							</tr>
							{{each value.list as vo ii}}
							<tr id="showDi{{i}}" style="display:none;">
							<td colspan="6" style="border: 0;">
								<table class="layui-table bg-white">
									<tr>
										<td class="text-right clearfix" style="border: 0;font-size: 14px;">
											<img src="{{vo.images}}" style="vertical-align: top;"/>
										</td>
										<td style="border: 0;font-size: 14px;width:270px;">
											{{vo.goods_name}}<br/>投放类型：{$data.type_name}<br/>
											位置：
											<switch name="position.device">
	                        					<case value="1">PC端</case>
	                        					<case value="2">移动端</case>
	                        					<default />未知
	                   	 					</switch>
											位置{$data['sort']+1}
										</td>
										<td class="text-center" style="border: 0;font-size: 16px;">{{vo.type}}</td>
										<td class="text-center" style="border: 0;font-size: 16px;">{{vo.time}}</td>
									</tr>
								</table>
							</td>
							</tr>
							{{/each}}
						{{/each}}
						<tr><td  class="text-center" colspan="5">{{#page.page}}</td></tr>
					</script>
				</div>
			</div>
		</div>
	</div>
</div>
<script src="__PUBLIC__/Jquery/DateTimePicker/jquery.datetimepicker.js"></script>
<script>
	$(function(){
		page(1);
	});
	var device="0";
	function setDvice(d,o){
		device=d;
		$(".btnc").removeClass("layui-btn-warm");
		$(".btnc").addClass("layui-btn-primary");
		$(o).removeClass("layui-btn-primary");
		$(o).addClass("layui-btn-warm");
	}
	function page(p){
		var aid={$data.id};
		var date=$("#date").val();
		if(date=="") date="0";
		$.post("__URL__/adsShowPath",{aid:aid,device:device,date:date,pagesizec:3,cpage:p},function(result){
			if(result){
				var data = {
						list:eval(result['list']),
						page:eval(result['page'])
				};
				var html = template('fwlj', data);
				$("#content").html(html);
			}else{
				$("#content").html("");
			}
		});
	}
	function showDi(n){
		if($("#showDi"+n).is(":hidden")){
			$("#ico"+n).html("&#xe61a;");
		}else{
			$("#ico"+n).html("&#xe619;");
		}
		$("#showDi"+n).toggle("slow");
	}
</script>